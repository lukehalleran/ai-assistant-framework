[1m============================= test session starts ==============================[0m
platform linux -- Python 3.11.8, pytest-8.4.2, pluggy-1.6.0 -- /home/lukeh/.pyenv/versions/3.11.8/bin/python
cachedir: .pytest_cache
rootdir: /home/lukeh/Daemon_RAG_Agent_working
configfile: pytest.ini
plugins: anyio-4.9.0, cov-7.0.0, asyncio-1.2.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
[1mcollecting ... [0mcollected 1554 items

tests/test_active_day_decay.py::test_active_day_tracking [31mFAILED[0m[31m          [  0%][0m
tests/test_active_day_decay.py::test_decay_calculation [32mPASSED[0m[31m            [  0%][0m
tests/test_active_day_decay.py::test_pause_resume_behavior [32mPASSED[0m[31m        [  0%][0m
tests/test_active_day_decay.py::test_comparison_with_old_system [32mPASSED[0m[31m   [  0%][0m
tests/test_active_day_decay.py::test_fallback_behavior [31mFAILED[0m[31m            [  0%][0m
tests/test_actual_caching.py::test_model_manager_cross_encoder_caching [32mPASSED[0m[31m [  0%][0m
tests/test_actual_caching.py::test_memory_manager_integration [32mPASSED[0m[31m     [  0%][0m
tests/test_basic_pipeline.py::test_basic_pipeline [32mPASSED[0m[31m                 [  0%][0m
tests/test_competitive_prototype.py::test_competitive_vs_baseline [31mFAILED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_extract_text_from_string [32mPASSED[0m[31m   [  0%][0m
tests/test_competitive_scorer.py::test_extract_text_from_dict_content [32mPASSED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_extract_text_from_dict_text [32mPASSED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_extract_text_from_dict_response [32mPASSED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_extract_text_from_conversation [32mPASSED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_basic [32mPASSED[0m[31m [  0%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_respects_budget [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_prioritizes_by_score [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_with_multiple_fields [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_empty_context [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_preserves_wiki [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_handles_missing_metadata [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_tokenizer_fallback [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_apply_competitive_selection_filters_short_text [32mPASSED[0m[31m [  1%][0m
tests/test_competitive_scorer.py::test_competitive_selection_value_per_token [32mPASSED[0m[31m [  1%][0m
tests/test_corpus_manager.py::test_corpus_manager_init [32mPASSED[0m[31m            [  1%][0m
tests/test_corpus_manager.py::test_add_entry [32mPASSED[0m[31m                      [  1%][0m
tests/test_corpus_manager.py::test_add_entry_with_timestamp [32mPASSED[0m[31m       [  1%][0m
tests/test_corpus_manager.py::test_get_recent_memories_empty [32mPASSED[0m[31m      [  1%][0m
tests/test_corpus_manager.py::test_get_recent_memories_with_data [32mPASSED[0m[31m  [  1%][0m
tests/test_corpus_manager.py::test_get_recent_memories_filters_summaries [32mPASSED[0m[31m [  1%][0m
tests/test_corpus_manager.py::test_add_summary [32mPASSED[0m[31m                    [  1%][0m
tests/test_corpus_manager.py::test_add_summary_with_timestamp [32mPASSED[0m[31m     [  2%][0m
tests/test_corpus_manager.py::test_get_summaries_empty [32mPASSED[0m[31m            [  2%][0m
tests/test_corpus_manager.py::test_get_summaries_returns_summaries [32mPASSED[0m[31m [  2%][0m
tests/test_corpus_manager.py::test_save_and_load_corpus [32mPASSED[0m[31m           [  2%][0m
tests/test_corpus_manager.py::test_clear_corpus_keep_summaries [32mPASSED[0m[31m    [  2%][0m
tests/test_corpus_manager.py::test_clear_corpus_delete_all [32mPASSED[0m[31m        [  2%][0m
tests/test_corpus_manager.py::test_prune_corpus [32mPASSED[0m[31m                   [  2%][0m
tests/test_corpus_manager.py::test_prune_corpus_preserve_summaries [32mPASSED[0m[31m [  2%][0m
tests/test_corpus_manager.py::test_get_summaries_of_type [32mPASSED[0m[31m          [  2%][0m
tests/test_corpus_manager.py::test_get_items_by_type [32mPASSED[0m[31m              [  2%][0m
tests/test_corpus_manager.py::test_clean_for_json [32mPASSED[0m[31m                 [  2%][0m
tests/test_corpus_manager.py::test_multiple_entries_ordering [32mPASSED[0m[31m      [  2%][0m
tests/test_corpus_manager.py::test_add_entry_with_empty_strings [32mPASSED[0m[31m   [  2%][0m
tests/test_corpus_manager.py::test_add_entry_with_none_response [32mPASSED[0m[31m   [  2%][0m
tests/test_corpus_manager.py::test_add_summary_empty_content [32mPASSED[0m[31m      [  2%][0m
tests/test_corpus_manager.py::test_corpus_persistence [32mPASSED[0m[31m             [  3%][0m
tests/test_corpus_manager.py::test_load_nonexistent_file [32mPASSED[0m[31m          [  3%][0m
tests/test_corpus_manager.py::test_save_requires_existing_directory [32mPASSED[0m[31m [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_corpus_manager_initialization [32mPASSED[0m[31m [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_add_entry_basic [32mPASSED[0m[31m  [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_add_entry_with_tags [32mPASSED[0m[31m [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_get_recent_memories_empty [32mPASSED[0m[31m [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_get_recent_memories_zero_count [32mPASSED[0m[31m [  3%][0m
tests/test_corpus_manager_comprehensive.py::test_get_items_by_type_with_limit [32mPASSED[0m[31m [  3%][0m
tests/test_cross_dedup_simple.py::test_cross_dedup [32mPASSED[0m[31m                [  3%][0m
tests/test_edge_cases_comprehensive.py::test_store_interaction_empty_strings [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_store_interaction_very_long_text [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_store_interaction_unicode_edge_cases [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_store_interaction_special_chars [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_get_memories_zero_limit [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_get_memories_negative_limit [32mPASSED[0m[31m [  3%][0m
tests/test_edge_cases_comprehensive.py::test_get_memories_huge_limit [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_get_memories_empty_query [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_get_memories_unicode_query [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_add_reflection_empty [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_add_reflection_very_long [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_add_reflection_with_all_params [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_get_reflections_zero [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_process_shutdown_memory_empty [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_process_shutdown_memory_none [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_run_shutdown_reflection_empty [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_all_none [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_very_long_input [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_unicode_input [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_special_model_name [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_custom_personality [32mPASSED[0m[31m [  4%][0m
tests/test_edge_cases_comprehensive.py::test_build_prompt_with_search_query [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_get_facts_empty_query [31mFAILED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_get_facts_unicode [31mFAILED[0m[31m    [  5%][0m
tests/test_edge_cases_comprehensive.py::test_corpus_manager_nonexistent_file [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_corpus_manager_add_entry_minimal [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_corpus_manager_get_recent_zero [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_corpus_manager_get_recent_negative [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_corpus_manager_multiple_entries [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_chroma_store_add_empty_text [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_chroma_store_add_very_long_text [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_chroma_store_query_nonexistent_collection [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_chroma_store_add_with_unicode_metadata [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_model_manager_stub_response [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_model_manager_stub_response_long [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_concurrent_store_interactions [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_concurrent_get_memories [32mPASSED[0m[31m [  5%][0m
tests/test_edge_cases_comprehensive.py::test_concurrent_build_prompts [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extraction_fixes.py::test_fact_extraction [32mPASSED[0m[31m         [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_looks_like_units_lb [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_looks_like_units_kg [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_looks_like_units_pound [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_looks_like_units_negative [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_has_number_unit_basic [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_has_number_unit_various_formats [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestUnitDetection::test_has_number_unit_no_match [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_relation_allows_adj_color_relations [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_relation_allows_adj_other_relations [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_is_clause_like_infinitive [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_is_clause_like_gerund [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_is_clause_like_passive [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_is_clause_like_negative [32mPASSED[0m[31m [  6%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_refine_is_relation_basic [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestRelationHelpers::test_refine_is_relation_no_change [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleScoring::test_score_triple_basic [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleScoring::test_score_triple_proper_nouns_higher [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleScoring::test_score_triple_generic_lower [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleScoring::test_score_triple_stop_words_penalized [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_extractor_initialization [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_extractor_initialization_no_rebel [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_extractor_initialization_no_regex [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_extractor_has_patterns [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_patterns_copular [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_fact_patterns_preference [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_lift_patterns_squat [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_lift_patterns_action [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestFactExtractor::test_extract_methods_exist [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_empty_subject [32mPASSED[0m[31m [  7%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_empty_relation [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_empty_object [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_basic [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_strips_whitespace [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestTripleCleaning::test_clean_triple_strips_punctuation [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestNormalization::test_normalize_subject_obj_first_person [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestNormalization::test_normalize_subject_obj_possessive [32mPASSED[0m[31m [  8%][0m
tests/test_fact_extractor_utils.py::TestNormalization::test_normalize_subject_obj_no_change [32mPASSED[0m[31m [  8%][0m
tests/test_file_processor.py::test_file_processor [32mPASSED[0m[31m                 [  8%][0m
tests/test_fix_verification.py::test_fix [32mPASSED[0m[31m                          [  8%][0m
tests/test_full_meta_query.py::test_full_flow [31mFAILED[0m[31m                     [  8%][0m
tests/test_gated_prompt.py::test_gated_builder [31mFAILED[0m[31m                    [  8%][0m
tests/test_health_check.py::test_health_check [32mPASSED[0m[31m                     [  8%][0m
tests/test_hybrid_retrieval.py::test_hybrid_retrieval [32mPASSED[0m[31m             [  8%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_from_conversation [32mPASSED[0m[31m [  8%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_with_rebel_disabled [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_with_measurements [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_with_preferences [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_empty_input [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_no_facts [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_structured_facts [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_from_message [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_deduplication [32mPASSED[0m[31m [  9%][0m
tests/test_integration_fact_extraction.py::test_extract_facts_with_context [32mPASSED[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gate_system_initialization [32mPASSED[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gate_system_filter_memories_empty [32mPASSED[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gate_system_filter_memories_with_data [32mPASSED[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gate_system_semantic_similarity [32mPASSED[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gated_prompt_builder_initialization [31mERROR[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gated_prompt_builder_basic [31mERROR[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gated_prompt_builder_with_memories [31mERROR[0m[31m [  9%][0m
tests/test_integration_gate_system.py::test_gate_system_cosine_threshold [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_gate_system.py::test_gate_system_handles_malformed_memories [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_gate_system.py::test_gated_prompt_integration_flow [31mERROR[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_get_recent_conversations [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_get_facts [31mFAILED[0m[31m         [ 10%][0m
tests/test_integration_prompt_advanced.py::test_get_recent_facts [31mFAILED[0m[31m  [ 10%][0m
tests/test_integration_prompt_advanced.py::test_build_prompt_with_personality [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_assemble_prompt_minimal [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_assemble_prompt_with_memories [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_build_prompt_error_handling [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_get_token_count [31mFAILED[0m[31m   [ 10%][0m
tests/test_integration_prompt_advanced.py::test_build_prompt_with_topic [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_build_prompt_smalltalk [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_advanced.py::test_build_prompt_question [32mPASSED[0m[31m [ 10%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_basic [31mFAILED[0m[31m [ 10%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_with_memories [31mFAILED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_with_search_query [31mFAILED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_with_current_topic [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_with_fresh_facts [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_build_prompt_with_system_prompt [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_prompt_builder_memory_integration [31mFAILED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_assemble_prompt_from_context [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_prompt_builder.py::test_prompt_builder_handles_empty_results [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_full_query_workflow [31mERROR[0m[31m      [ 11%][0m
tests/test_integration_workflows.py::test_memory_retrieval_with_topics [31mERROR[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_memory_relevance_scoring [31mERROR[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_prompt_building_workflow [31mERROR[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_response_generation_flow [32mPASSED[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_memory_with_empty_query [31mERROR[0m[31m  [ 11%][0m
tests/test_integration_workflows.py::test_memory_with_special_characters [31mERROR[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_multiple_sequential_interactions [31mERROR[0m[31m [ 11%][0m
tests/test_integration_workflows.py::test_memory_with_long_text [31mERROR[0m[31m    [ 12%][0m
tests/test_integration_workflows.py::test_orchestrator_static_methods [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_prompt_builder_with_empty_memories [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_memory_consolidation_trigger [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_gate_system_integration [31mERROR[0m[31m  [ 12%][0m
tests/test_integration_workflows.py::test_time_manager_integration [31mFAILED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_corpus_manager_save_load [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_memory_with_tags_filtering [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_concurrent_memory_operations [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_response_generator_with_errors [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_prompt_builder_token_limiting [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_memory_recent_retrieval [31mERROR[0m[31m  [ 12%][0m
tests/test_integration_workflows.py::test_memory_with_unicode_content [31mERROR[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_orchestrator_fallback_memory [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_orchestrator_fallback_corpus [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_orchestrator_simple_prompt_builder [32mPASSED[0m[31m [ 12%][0m
tests/test_integration_workflows.py::test_memory_scorer_integration [31mERROR[0m[31m [ 13%][0m
tests/test_integration_workflows.py::test_model_manager_initialization [31mFAILED[0m[31m [ 13%][0m
tests/test_integration_workflows.py::test_corpus_manager_with_thread_info [32mPASSED[0m[31m [ 13%][0m
tests/test_integration_workflows.py::test_memory_retrieval_with_config [31mERROR[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_normal [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_special_chars [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_multiple_spaces [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_empty [32mPASSED[0m[31m  [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_none [32mPASSED[0m[31m   [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_snake_strips_leading_trailing [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_valid [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_pronouns [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_missing_fields [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_empty_strings [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_coerces_numbers [32mPASSED[0m[31m [ 13%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_normalize_triple_strips_periods [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_llm_extractor_init [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_llm_extractor_custom_params [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_basic [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_empty_list [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_strips_role_prefixes [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_enforces_char_budget [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_limits_messages [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_build_prompt_skips_empty_messages [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_empty_input [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_with_model_failure [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_with_invalid_json [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_with_non_list_json [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_with_valid_json [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_with_junk_around_json [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_deduplicates [32mPASSED[0m[31m [ 14%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_max_triples_limit [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_skips_invalid_items [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_empty_string_response [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fact_extractor_comprehensive.py::test_extract_triples_none_response [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fallback.py::test_llm_fallback_triggers_on_borderline [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fallback.py::test_llm_fallback_prevents_false_positive [32mPASSED[0m[31m [ 15%][0m
tests/test_llm_fallback.py::test_no_llm_without_model_manager [32mPASSED[0m[31m     [ 15%][0m
tests/test_memory_consolidator.py::test_format_recent_for_summary_empty [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_format_recent_for_summary_basic [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_format_recent_for_summary_long_text [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_format_recent_for_summary_empty_entries [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_format_recent_for_summary_malformed [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_consolidator_init [32mPASSED[0m[31m         [ 15%][0m
tests/test_memory_consolidator.py::test_consolidator_init_defaults [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_not_due [32mPASSED[0m[31m [ 15%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_no_model_manager [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_creates_summary [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_recent_summary_exists [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_empty_corpus [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_maybe_consolidate_model_error [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_format_recent_mixed_timestamps [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_consolidator.py::test_format_recent_unicode [32mPASSED[0m[31m     [ 16%][0m
tests/test_memory_coordinator.py::test_memory_coordinator [32mPASSED[0m[31m         [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_calculate_truth_score_high [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_calculate_truth_score_low [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_calculate_importance_score_high [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_calculate_importance_score_baseline [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_update_truth_scores_on_access [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_update_truth_scores_empty_list [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_add_reflection [32mPASSED[0m[31m    [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_add_reflection_with_timestamp [32mPASSED[0m[31m [ 16%][0m
tests/test_memory_coordinator_advanced.py::test_get_reflections [32mPASSED[0m[31m   [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_reflections_hybrid [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_recent_facts [32mPASSED[0m[31m  [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_facts_with_query [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_thread_context_none [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_detect_or_create_thread [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_semantic_top_memories [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_search_by_type [32mPASSED[0m[31m    [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_get_recent_conversations [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_parse_result [32mPASSED[0m[31m      [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_parse_result_minimal [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_gate_memories_filters [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_rank_memories [32mPASSED[0m[31m     [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_rank_memories_empty [32mPASSED[0m[31m [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_now [32mPASSED[0m[31m               [ 17%][0m
tests/test_memory_coordinator_advanced.py::test_now_iso [32mPASSED[0m[31m           [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_safe_detect_topic [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_safe_detect_topic_empty [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_get_memory_key [32mPASSED[0m[31m    [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_get_memory_key_no_id [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_format_hierarchical_memory [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_format_hierarchical_memory_simple [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_get_summaries [32mPASSED[0m[31m     [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_get_summaries_hybrid [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_get_dreams [32mPASSED[0m[31m        [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_debug_memory_state [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_combine_memories [33mSKIPPED[0m[31m [ 18%][0m
tests/test_memory_coordinator_advanced.py::test_consolidate_and_store_summary [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_explain [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_that [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_it [32mPASSED[0m[31m [ 18%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_this [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_again [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_another_way [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_different_way [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_not_deictic [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_empty [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_none [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_case_insensitive [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_basic [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_filters_stopwords [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_lowercase [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_empty [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_all_stopwords [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_k_limit [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_short_words [32mPASSED[0m[31m [ 19%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_with_numbers [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_multiplication [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_division [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_no_operations [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_empty [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_multiple_operations [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_word_problem [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_like [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_similar [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_as_if [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_reminds [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_analogy [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_metaphor [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_no_markers [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_empty [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_multiple [32mPASSED[0m[31m [ 20%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_case_insensitive [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_basic [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_extracts_from_queries [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_extracts_from_responses [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_empty_conversation [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_maxlen_limit [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_filters_stopwords [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_missing_fields [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_none_values [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_lowercase [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_salient_tokens_with_punctuation [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_num_op_density_complex_expression [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_analogy_markers_comparison [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_build_anchor_tokens_long_text [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_helpers.py::test_is_deictic_followup_combined_hints [32mPASSED[0m[31m [ 21%][0m
tests/test_memory_coordinator_methods.py::test_is_deictic_followup_true [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_is_deictic_followup_false [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_is_deictic_followup_empty [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_salient_tokens_basic [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_salient_tokens_with_numbers [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_salient_tokens_empty [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_num_op_density_high [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_num_op_density_low [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_num_op_density_empty [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_analogy_markers_present [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_analogy_markers_absent [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_analogy_markers_empty [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_store_interaction_basic [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_store_interaction_with_tags [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_get_memories_empty_query [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_get_memories_after_storing [32mPASSED[0m[31m [ 22%][0m
tests/test_memory_coordinator_methods.py::test_get_facts_empty_query [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_get_facts_basic [32mPASSED[0m[31m    [ 23%][0m
tests/test_memory_coordinator_methods.py::test_extract_and_store_facts [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_consolidate_with_model [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_update_memory_access [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_get_semantic_top_memories [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_conversation_context_tracking [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_topic_tracking [32mPASSED[0m[31m     [ 23%][0m
tests/test_memory_coordinator_methods.py::test_get_summaries [32mPASSED[0m[31m      [ 23%][0m
tests/test_memory_coordinator_methods.py::test_multiple_interactions_ordering [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_empty_response_handling [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_coordinator_methods.py::test_empty_query_handling [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_deep_integration.py::test_store_interaction_full_metadata [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_deep_integration.py::test_store_interaction_triggers_consolidation [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_deep_integration.py::test_get_memories_with_topic_filter [32mPASSED[0m[31m [ 23%][0m
tests/test_memory_deep_integration.py::test_get_memories_semantic_search [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_process_shutdown_memory [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_run_shutdown_reflection [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_get_meta_conversational_memories [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_get_semantic_memories [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_combine_memories_deduplication [33mSKIPPED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_thread_detection_and_tracking [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_decay_old_memories [32mPASSED[0m[31m    [ 24%][0m
tests/test_memory_deep_integration.py::test_importance_boosting [32mPASSED[0m[31m   [ 24%][0m
tests/test_memory_deep_integration.py::test_hierarchical_memory_relationships [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_fact_extraction_flow [32mPASSED[0m[31m  [ 24%][0m
tests/test_memory_deep_integration.py::test_reflection_generation [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_memory_access_tracking [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_cross_collection_search [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_time_context_awareness [32mPASSED[0m[31m [ 24%][0m
tests/test_memory_deep_integration.py::test_memory_pruning [32mPASSED[0m[31m        [ 24%][0m
tests/test_memory_deep_integration.py::test_query_expansion [32mPASSED[0m[31m       [ 25%][0m
tests/test_memory_deep_integration.py::test_empty_query_handling [32mPASSED[0m[31m  [ 25%][0m
tests/test_memory_deep_integration.py::test_very_long_query [32mPASSED[0m[31m       [ 25%][0m
tests/test_memory_deep_integration.py::test_special_characters_in_query [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_deep_integration.py::test_unicode_content [32mPASSED[0m[31m       [ 25%][0m
tests/test_memory_fixes.py::test_memory_retrieval [32mPASSED[0m[31m                 [ 25%][0m
tests/test_memory_fixes.py::test_gating_directly [32mPASSED[0m[31m                  [ 25%][0m
tests/test_memory_internal_methods.py::test_get_semantic_memories_internal [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_combine_memories_internal [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_gate_memories_internal [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_calculate_truth_score [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_calculate_importance_score_various_content [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_update_truth_scores_on_access [32mPASSED[0m[31m [ 25%][0m
tests/test_memory_internal_methods.py::test_rank_memories [32mPASSED[0m[31m         [ 25%][0m
tests/test_memory_internal_methods.py::test_parse_result [32mPASSED[0m[31m          [ 25%][0m
tests/test_memory_internal_methods.py::test_get_memory_key [32mPASSED[0m[31m        [ 25%][0m
tests/test_memory_internal_methods.py::test_safe_detect_topic [32mPASSED[0m[31m     [ 26%][0m
tests/test_memory_internal_methods.py::test_get_recent_conversations [32mPASSED[0m[31m [ 26%][0m
tests/test_memory_internal_methods.py::test_get_recent_facts [32mPASSED[0m[31m      [ 26%][0m
tests/test_memory_internal_methods.py::test_get_facts_with_query [32mPASSED[0m[31m  [ 26%][0m
tests/test_memory_internal_methods.py::test_search_by_type [32mPASSED[0m[31m        [ 26%][0m
tests/test_memory_internal_methods.py::test_get_semantic_top_memories [32mPASSED[0m[31m [ 26%][0m
tests/test_memory_internal_methods.py::test_get_thread_context [32mPASSED[0m[31m    [ 26%][0m
tests/test_memory_internal_methods.py::test_detect_or_create_thread [32mPASSED[0m[31m [ 26%][0m
tests/test_memory_internal_methods.py::test_consolidate_and_store_summary [32mPASSED[0m[31m [ 26%][0m
tests/test_memory_internal_methods.py::test_extract_and_store_facts [32mPASSED[0m[31m [ 26%][0m
tests/test_memory_internal_methods.py::test_get_meta_conversational_memories [32mPASSED[0m[31m [ 26%][0m
tests/test_meta_bonus.py::test_meta_conversational_bonus [31mFAILED[0m[31m          [ 26%][0m
tests/test_meta_conversational.py::test_meta_conversational_detection [32mPASSED[0m[31m [ 26%][0m
tests/test_meta_conversational.py::test_query_analysis [32mPASSED[0m[31m            [ 26%][0m
tests/test_meta_query.py::test_meta_query [32mPASSED[0m[31m                         [ 26%][0m
tests/test_meta_retrieval.py::test_meta_retrieval_routing [32mPASSED[0m[31m         [ 27%][0m
tests/test_meta_retrieval.py::test_detection_summary [32mPASSED[0m[31m              [ 27%][0m
tests/test_meta_routing_debug.py::test_routing [32mPASSED[0m[31m                    [ 27%][0m
tests/test_middle_out_compression.py::test_per_item_compression [32mPASSED[0m[31m   [ 27%][0m
tests/test_middle_out_compression.py::test_whole_prompt_fallback [32mPASSED[0m[31m  [ 27%][0m
tests/test_model_manager_methods.py::test_model_manager_init [32mPASSED[0m[31m      [ 27%][0m
tests/test_model_manager_methods.py::test_model_manager_init_with_api_key [32mPASSED[0m[31m [ 27%][0m
tests/test_model_manager_methods.py::test_model_manager_init_no_openai [32mPASSED[0m[31m [ 27%][0m
tests/test_model_manager_methods.py::test_stub_response [32mPASSED[0m[31m           [ 27%][0m
tests/test_model_manager_methods.py::test_stub_response_long_prompt [32mPASSED[0m[31m [ 27%][0m
tests/test_model_manager_methods.py::test_stub_response_empty_prompt [32mPASSED[0m[31m [ 27%][0m
tests/test_model_manager_methods.py::test_stub_response_multiline_prompt [32mPASSED[0m[31m [ 27%][0m
tests/test_model_manager_methods.py::test_stub_stream [32mPASSED[0m[31m             [ 27%][0m
tests/test_model_manager_methods.py::test_is_api_model [32mPASSED[0m[31m            [ 27%][0m
tests/test_model_manager_methods.py::test_is_api_model_false [32mPASSED[0m[31m      [ 27%][0m
tests/test_model_manager_methods.py::test_load_openai_model [32mPASSED[0m[31m       [ 27%][0m
tests/test_model_manager_methods.py::test_switch_model [32mPASSED[0m[31m            [ 28%][0m
tests/test_model_manager_methods.py::test_get_active_model_name [32mPASSED[0m[31m   [ 28%][0m
tests/test_model_manager_methods.py::test_get_active_model_name_none [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_get_model_not_loaded [32mPASSED[0m[31m    [ 28%][0m
tests/test_model_manager_methods.py::test_get_tokenizer_not_loaded [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_get_embedder [32mPASSED[0m[31m            [ 28%][0m
tests/test_model_manager_methods.py::test_get_context_limit_api_model [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_get_context_limit_no_model [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_truncate_prompt_no_truncation_needed [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_truncate_prompt_with_truncation [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_close [32mPASSED[0m[31m                   [ 28%][0m
tests/test_model_manager_methods.py::test_close_no_client [32mPASSED[0m[31m         [ 28%][0m
tests/test_model_manager_methods.py::test_aclose [32mPASSED[0m[31m                  [ 28%][0m
tests/test_model_manager_methods.py::test_list_provider_models_no_client [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_list_provider_models_with_vendor_filter [32mPASSED[0m[31m [ 28%][0m
tests/test_model_manager_methods.py::test_api_model_aliases [32mPASSED[0m[31m       [ 29%][0m
tests/test_model_manager_methods.py::test_default_parameters [32mPASSED[0m[31m      [ 29%][0m
tests/test_model_manager_methods.py::test_base_url [32mPASSED[0m[31m                [ 29%][0m
tests/test_model_manager_methods.py::test_allow_fallback_default [32mPASSED[0m[31m  [ 29%][0m
tests/test_model_manager_methods.py::test_generate_async_stub_when_no_client [32mPASSED[0m[31m [ 29%][0m
tests/test_model_manager_methods.py::test_generate_with_unknown_model [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_primitives [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_none [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_list [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_dict [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_empty [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_flatten_for_chroma_none_input [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_chroma_store_init [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_chroma_store_collections_initialized [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_add_conversation_memory [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_add_conversation_memory_with_none_metadata [32mPASSED[0m[31m [ 29%][0m
tests/test_multi_collection_chroma_store.py::test_add_summary [32mPASSED[0m[31m     [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_summary_with_metadata [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_wiki_chunk [32mPASSED[0m[31m  [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_fact_basic [32mPASSED[0m[31m  [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_fact_with_legacy_dict_source [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_fact_with_parent_child [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_reflection [32mPASSED[0m[31m  [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_query_collection [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_query_collection_with_alias_kwargs [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_query_collection_invalid_name [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_search_all [32mPASSED[0m[31m      [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_get_collection_stats [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_to_collection [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_add_to_collection_creates_if_missing [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_list_all_empty_collection [32mPASSED[0m[31m [ 30%][0m
tests/test_multi_collection_chroma_store.py::test_list_all_with_data [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_list_all_invalid_collection [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_get_recent [32mPASSED[0m[31m      [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_get_recent_without_timestamps [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_create_collection [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_generate_id [32mPASSED[0m[31m     [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_collection_embedder_name [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_multiple_facts_added [32mPASSED[0m[31m [ 31%][0m
tests/test_multi_collection_chroma_store.py::test_query_returns_formatted_results [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[I am lonely-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[I'm sad-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[This sucks-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[Ugh-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[It hurts-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[I'm tired-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[I don't know anymore-NeedType.PRESENCE] [32mPASSED[0m[31m [ 31%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[I feel empty-NeedType.PRESENCE] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPresenceDetection::test_short_emotional_statements[Everything feels heavy-NeedType.PRESENCE] [31mFAILED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPresenceDetection::test_single_word_exhales [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[I think the reason dating is hard is my living situation-NeedType.PERSPECTIVE] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[Should I try a different approach?-NeedType.PERSPECTIVE] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[The problem is I don't have enough time-NeedType.PERSPECTIVE] [31mFAILED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[I'm not sure if I should take the job because the pay is lower-NeedType.PERSPECTIVE] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[Do you think I'm overreacting?-NeedType.PERSPECTIVE] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[Maybe I should reconsider my options-NeedType.PERSPECTIVE] [31mFAILED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_problem_framing_statements[What would you do in my situation?-NeedType.PERSPECTIVE] [31mFAILED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestPerspectiveDetection::test_question_marks_favor_perspective [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestNeutralCases::test_minimal_messages[Okay] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestNeutralCases::test_minimal_messages[Thanks] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestNeutralCases::test_minimal_messages[Got it] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestNeutralCases::test_minimal_messages[Sure] [32mPASSED[0m[31m [ 32%][0m
tests/test_need_detection.py::TestNeutralCases::test_minimal_messages[Cool] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestNeutralCases::test_informational_updates [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestSemanticDetection::test_paraphrased_presence [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestSemanticDetection::test_paraphrased_perspective [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestHybridDetection::test_keyword_and_semantic_agreement_boosts_confidence [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestHybridDetection::test_semantic_can_override_weak_keyword [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestEdgeCases::test_i_feel_like_vs_i_feel [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestEdgeCases::test_long_emotional_statements_still_presence [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestEdgeCases::test_questions_about_feelings_are_perspective [31mFAILED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[Morning man!-NeedType.NEUTRAL] [31mFAILED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[I'm still feeling a little off. Not like yesterday more just frustration. Online dating sucks lol I get so many matches and I think the reason they don't go anywhere is my school/living situation-NeedType.PERSPECTIVE] [31mFAILED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[Like I mentioned before I live with my mom at the moment-NeedType.NEUTRAL] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[I lead with transitional info when it comes up. I feel like I am in a good position. In two years I will be making more than 90% of my matches-NeedType.PERSPECTIVE] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[No one can see it ugh. I will have to wait 2 years-NeedType.PRESENCE] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[It feels very long. I am lonely-NeedType.PRESENCE] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestDebugLogCases::test_debug_log_examples[I'm not it's just. Ugh. I will be 34-NeedType.PRESENCE] [32mPASSED[0m[31m [ 33%][0m
tests/test_need_detection.py::TestKeywordDetectionUnit::test_keyword_detection_basic [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestKeywordDetectionUnit::test_keyword_perspective_markers [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestKeywordDetectionUnit::test_keyword_short_message_bias [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestKeywordDetectionUnit::test_keyword_question_bias [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestConfidenceScoring::test_high_confidence_fast_path [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestConfidenceScoring::test_neutral_confidence [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestExtremeMessages::test_empty_message [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestExtremeMessages::test_very_long_message [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestExtremeMessages::test_mixed_signals [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestMessageVariations::test_lonely_variations [32mPASSED[0m[31m [ 34%][0m
tests/test_need_detection.py::TestMessageVariations::test_problem_framing_variations [31mFAILED[0m[31m [ 34%][0m
tests/test_orchestrator_helpers.py::test_parse_thinking_block_with_both_tags [32mPASSED[0m[31m [ 34%][0m
tests/test_orchestrator_helpers.py::test_parse_thinking_block_closing_only [32mPASSED[0m[31m [ 34%][0m
tests/test_orchestrator_helpers.py::test_parse_thinking_block_no_tags [32mPASSED[0m[31m [ 34%][0m
tests/test_orchestrator_helpers.py::test_parse_thinking_block_empty_response [32mPASSED[0m[31m [ 34%][0m
tests/test_orchestrator_helpers.py::test_parse_thinking_block_nested_tags [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_result_tag [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_answer_tag [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_final_tag [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_with_attributes [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_no_tags [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_empty [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_none [32mPASSED[0m[31m  [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_partial_tag [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_wrappers_multiple_lines [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_time_context [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_recent_conversation [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_relevant_info [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_facts [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_directives [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_user_input [32mPASSED[0m[31m [ 35%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_background_knowledge [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_summaries [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_reflections [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_multiple_headers [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_no_headers [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_empty [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_none [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_case_insensitive [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_preserves_content [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_header_with_brackets [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_current_facts [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_session_reflections [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_extract_thinking_with_whitespace [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_case_insensitive [32mPASSED[0m[31m [ 36%][0m
tests/test_orchestrator_helpers.py::test_strip_xml_with_spaces [32mPASSED[0m[31m    [ 36%][0m
tests/test_orchestrator_helpers.py::test_extract_thinking_only_closing_tag_at_end [32mPASSED[0m[31m [ 37%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_relevant_memories [32mPASSED[0m[31m [ 37%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_recent_facts [32mPASSED[0m[31m [ 37%][0m
tests/test_orchestrator_helpers.py::test_strip_prompt_artifacts_current_query [32mPASSED[0m[31m [ 37%][0m
tests/test_performance_fix.py::test_cross_encoder_caching [31mFAILED[0m[31m         [ 37%][0m
tests/test_performance_fix.py::test_gate_system_reuse [32mPASSED[0m[31m             [ 37%][0m
tests/test_performance_fix.py::test_performance_improvement_simulation [32mPASSED[0m[31m [ 37%][0m
tests/test_performance_fix.py::test_end_to_end_integration [31mFAILED[0m[31m        [ 37%][0m
tests/test_prompt_builder_methods.py::test_middle_out_no_compression_needed [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_middle_out_compression_applied [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_middle_out_with_force_flag [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_get_time_context [32mPASSED[0m[31m       [ 37%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_string [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_dict_content [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_dict_text [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_dict_response [32mPASSED[0m[31m [ 37%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_empty_dict [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_extract_text_from_none [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_format_memory_basic [32mPASSED[0m[31m    [ 38%][0m
tests/test_prompt_builder_methods.py::test_format_memory_no_timestamp [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_format_memory_with_custom_formatter [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_llm_summarize_recent_empty [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_llm_summarize_recent_no_model_manager [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_get_recent_conversations_general_topic [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_get_recent_conversations_specific_topic [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_load_directives_nonexistent_file [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_get_token_count_basic [33mSKIPPED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_get_token_count_empty [33mSKIPPED[0m[31m [ 38%][0m
tests/test_prompt_builder_methods.py::test_get_token_count_long_text [33mSKIPPED[0m[31m [ 38%][0m
tests/test_prompt_builder_wrapper.py::test_unified_hierarchical_builder_initialization [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_wrapper.py::test_unified_hierarchical_builder_with_chroma [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_wrapper.py::test_unified_hierarchical_builder_no_consolidator [32mPASSED[0m[31m [ 38%][0m
tests/test_prompt_builder_wrapper.py::test_build_prompt_delegates_to_async [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_build_prompt_delegates_to_gated [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_build_prompt_handles_sync_builder [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_build_prompt_raises_on_no_method [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_getattr_delegation [32mPASSED[0m[31m     [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_getattr_delegation_missing_attribute [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_unified_prompt_builder_export [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_prompt_builder_export [32mPASSED[0m[31m  [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_all_exports [32mPASSED[0m[31m            [ 39%][0m
tests/test_prompt_builder_wrapper.py::test_wrapper_with_extra_kwargs [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_caching.py::test_caching_support [32mPASSED[0m[31m                [ 39%][0m
tests/test_prompt_caching.py::test_message_formatting [32mPASSED[0m[31m             [ 39%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_force_llm_summaries [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_cadence_summaries [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_heavy_retrieval [32mPASSED[0m[31m [ 39%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_custom_system_prompt [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_wiki_retrieval [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_facts [32mPASSED[0m[31m     [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_reflections [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_token_budget_enforcement [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_empty_query [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_very_long_query [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_multiple_calls [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_get_summaries_with_stored [32mPASSED[0m[31m   [ 40%][0m
tests/test_prompt_deep_paths.py::test_get_summaries_empty [32mPASSED[0m[31m         [ 40%][0m
tests/test_prompt_deep_paths.py::test_get_recent_conversations [32mPASSED[0m[31m    [ 40%][0m
tests/test_prompt_deep_paths.py::test_persist_summary [32mPASSED[0m[31m             [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_with_different_models [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_deep_paths.py::test_build_prompt_increments_counter [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_internal_methods.py::test_middle_out [32mPASSED[0m[31m            [ 40%][0m
tests/test_prompt_internal_methods.py::test_middle_out_short_text [32mPASSED[0m[31m [ 40%][0m
tests/test_prompt_internal_methods.py::test_middle_out_force_mode [32mPASSED[0m[31m [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_summaries [32mPASSED[0m[31m         [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_reflections [32mPASSED[0m[31m       [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_summaries_hybrid_filtered [32mPASSED[0m[31m [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_reflections_hybrid_filtered [32mPASSED[0m[31m [ 41%][0m
tests/test_prompt_internal_methods.py::test_hygiene_and_caps [32mPASSED[0m[31m      [ 41%][0m
tests/test_prompt_internal_methods.py::test_manage_token_budget [33mSKIPPED[0m[31m  [ 41%][0m
tests/test_prompt_internal_methods.py::test_assemble_prompt [32mPASSED[0m[31m       [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_token_count [33mSKIPPED[0m[31m      [ 41%][0m
tests/test_prompt_internal_methods.py::test_extract_text [32mPASSED[0m[31m          [ 41%][0m
tests/test_prompt_internal_methods.py::test_format_memory [32mPASSED[0m[31m         [ 41%][0m
tests/test_prompt_internal_methods.py::test_format_memory_without_timestamp [32mPASSED[0m[31m [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_recent_facts [32mPASSED[0m[31m      [ 41%][0m
tests/test_prompt_internal_methods.py::test_get_facts_with_query [32mPASSED[0m[31m  [ 41%][0m
tests/test_prompt_internal_methods.py::test_gather_context [32mPASSED[0m[31m        [ 41%][0m
tests/test_prompt_internal_methods.py::test_build_default_memory_coordinator [32mPASSED[0m[31m [ 42%][0m
tests/test_prompt_sections.py::test_prompt [31mFAILED[0m[31m                        [ 42%][0m
tests/test_real_mutations.py::test_snake_mutations [32mPASSED[0m[31m                [ 42%][0m
tests/test_response_generator.py::test_response_generator_init [32mPASSED[0m[31m    [ 42%][0m
tests/test_response_generator.py::test_generate_streaming_response_basic [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_generate_streaming_response_with_max_tokens [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_generate_streaming_response_no_system_prompt [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_generate_full [32mPASSED[0m[31m              [ 42%][0m
tests/test_response_generator.py::test_generate_full_with_temperature [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_coverage_score_high [32mPASSED[0m[31m        [ 42%][0m
tests/test_response_generator.py::test_coverage_score_low [32mPASSED[0m[31m         [ 42%][0m
tests/test_response_generator.py::test_length_score_optimal [32mPASSED[0m[31m       [ 42%][0m
tests/test_response_generator.py::test_length_score_too_short [32mPASSED[0m[31m     [ 42%][0m
tests/test_response_generator.py::test_length_score_too_long [32mPASSED[0m[31m      [ 42%][0m
tests/test_response_generator.py::test_repetition_penalty_no_repetition [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_repetition_penalty_with_repetition [32mPASSED[0m[31m [ 42%][0m
tests/test_response_generator.py::test_hallucination_penalty_no_context [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator.py::test_hallucination_penalty_with_uncertainty [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator.py::test_score_answer_comprehensive [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator.py::test_score_answer_poor_quality [32mPASSED[0m[31m  [ 43%][0m
tests/test_response_generator.py::test_generate_best_of [32mPASSED[0m[31m           [ 43%][0m
tests/test_response_generator.py::test_minmax_normalize_empty [32mPASSED[0m[31m     [ 43%][0m
tests/test_response_generator.py::test_minmax_normalize_single_value [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator.py::test_minmax_normalize_multiple_values [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator.py::test_llm_judge_methods_exist [32mPASSED[0m[31m    [ 43%][0m
tests/test_response_generator.py::test_generate_streaming_error_handling [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_coverage_score_basic [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_coverage_score_empty_answer [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_coverage_score_with_context [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_length_score_normal [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_length_score_too_short [32mPASSED[0m[31m [ 43%][0m
tests/test_response_generator_comprehensive.py::test_length_score_too_long [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_length_score_custom_bounds [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_repetition_penalty_no_repetition [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_repetition_penalty_high_repetition [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_repetition_penalty_empty [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_hallucination_penalty_normal [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_hallucination_penalty_with_context [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_hallucination_penalty_suspicious [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_score_answer [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_score_answer_with_context [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_score_answer_poor_quality [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_minmax_normalize_normal [31mFAILED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_minmax_normalize_single_value [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_minmax_normalize_all_same [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_minmax_normalize_empty [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_generate_full_basic [32mPASSED[0m[31m [ 44%][0m
tests/test_response_generator_comprehensive.py::test_generate_full_with_system_prompt [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_full_with_temperature [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_best_of_basic [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_best_of_with_context [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_llm_judge_score [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_llm_judge_compare [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_duel_and_judge [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_best_of_ensemble [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_response_generator_initialization [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_response_generator_with_time_manager [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_streaming_response_basic [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_comprehensive.py::test_generate_streaming_response_with_system [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_streaming.py::test_streaming_with_string_chunks [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_streaming.py::test_streaming_with_dict_chunks [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_streaming.py::test_streaming_with_openai_chunks [32mPASSED[0m[31m [ 45%][0m
tests/test_response_generator_streaming.py::test_streaming_with_stop_markers [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_user_marker [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_assistant_marker [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_system_marker [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_eot_marker [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_word_by_word [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_empty_chunks [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_chunk_error [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_max_tokens [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_non_streaming_response [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_non_streaming_without_message_attr [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_non_streaming_no_choices [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_error_handling [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_custom_system_prompt [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_empty_system_prompt [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_with_none_system_prompt [32mPASSED[0m[31m [ 46%][0m
tests/test_response_generator_streaming.py::test_streaming_buffer_flush [32mPASSED[0m[31m [ 47%][0m
tests/test_response_generator_streaming.py::test_streaming_with_model_switch [32mPASSED[0m[31m [ 47%][0m
tests/test_response_generator_streaming.py::test_streaming_config_import_failure [32mPASSED[0m[31m [ 47%][0m
tests/test_semantic_quality.py::test_gym_health_search [32mPASSED[0m[31m            [ 47%][0m
tests/test_simple_mutation.py::test_simple_add [32mPASSED[0m[31m                    [ 47%][0m
tests/test_simple_mutation.py::test_simple_max [32mPASSED[0m[31m                    [ 47%][0m
tests/test_simple_validation.py::test_cross_encoder_caching [32mPASSED[0m[31m       [ 47%][0m
tests/test_simple_validation.py::test_mock_performance_improvement [32mPASSED[0m[31m [ 47%][0m
tests/test_stm_fix.py::test_meta_conversational_detection [32mPASSED[0m[31m         [ 47%][0m
tests/test_stm_fix.py::test_topic_change_scenario [32mPASSED[0m[31m                 [ 47%][0m
tests/test_stm_live.py::test_stm_in_orchestrator [32mPASSED[0m[31m                  [ 47%][0m
tests/test_summaries.py::test_summary_integration [32mPASSED[0m[31m                 [ 47%][0m
tests/test_temporal_retrieval.py::test_temporal_retrieval [32mPASSED[0m[31m         [ 47%][0m
tests/test_thinking_blocks.py::test_parse_thinking_block [32mPASSED[0m[31m          [ 47%][0m
tests/test_thinking_blocks.py::test_system_prompt_modification [32mPASSED[0m[31m    [ 47%][0m
tests/test_thinking_blocks.py::test_integration [32mPASSED[0m[31m                   [ 48%][0m
tests/test_thinking_stream.py::test_parse_thinking_block [32mPASSED[0m[31m          [ 48%][0m
tests/test_thread_tracking.py::test_thread_tracking [31mFAILED[0m[31m               [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_initialization [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_basic [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_empty [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_long_text [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_different_models [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_special_characters [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_code [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_json [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_unicode [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_very_long [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_none [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_numbers [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_truncate_to_token_limit [32mPASSED[0m[31m [ 48%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_estimate_tokens_per_message [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_tokenizer_singleton_behavior [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_markdown [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManager::test_count_tokens_whitespace [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_initialization_without_model_manager [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_whitespace_tokenizer [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_whitespace_tokenizer_empty [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_tiktoken_wrapper [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_choose_tiktoken_encoding_o_series [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_choose_tiktoken_encoding_standard [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_looks_like_api_model [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_is_api_model_with_exception [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_count_tokens_fallback [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_get_tokenizer_caching [32mPASSED[0m[31m [ 49%][0m
tests/test_tokenizer_manager.py::TestTokenizerManagerEdgeCases::test_count_tokens_with_none_model [32mPASSED[0m[31m [ 49%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case0] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case1] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case2] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case3] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case4] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case5] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case6] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case7] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case8] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case9] [32mPASSED[0m[31m   [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case10] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case11] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case12] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case13] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case14] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case15] [32mPASSED[0m[31m  [ 50%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case16] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case17] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case18] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case19] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case20] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case21] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case22] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case23] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case24] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case25] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case26] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case27] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case28] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_crisis_detection[test_case29] [32mPASSED[0m[31m  [ 51%][0m
tests/test_tone_detection.py::test_observational_language_detection [32mPASSED[0m[31m [ 51%][0m
tests/test_tone_detection.py::test_keyword_detection [32mPASSED[0m[31m              [ 51%][0m
tests/test_tone_detection.py::test_context_escalation [32mPASSED[0m[31m             [ 52%][0m
tests/test_tone_detection.py::test_semantic_detection_examples [31mFAILED[0m[31m    [ 52%][0m
tests/test_tone_detection.py::test_tone_shift_detection [32mPASSED[0m[31m           [ 52%][0m
tests/test_tone_detection.py::test_print_category_summary [32mPASSED[0m[31m         [ 52%][0m
tests/test_tone_execution.py::test_tone_detection [31mFAILED[0m[31m                 [ 52%][0m
tests/test_tone_fix.py::test_tone_in_prepare_prompt [32mPASSED[0m[31m               [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_simple_topic_extraction [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_capitalized_topic_preference [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_strip_question_words [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_ambiguous_topics [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_topic_persistence [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicManager::test_general_fallback [31mFAILED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicStorage::test_topic_stored_correctly [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicStorage::test_topic_not_defaulting_to_general [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicStorage::test_multiple_interactions_different_topics [32mPASSED[0m[31m [ 52%][0m
tests/test_topic_detection.py::TestTopicIntegration::test_topic_extraction_and_storage_flow [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_no_variables [32mPASSED[0m[31m     [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_simple_substitution [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_nested_keys [32mPASSED[0m[31m      [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_multiple_substitutions [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_nested_resolution [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_missing_reference [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_dict_values [32mPASSED[0m[31m      [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_list_values [32mPASSED[0m[31m      [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_non_string_values [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_circular_reference_safety [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_empty_config [32mPASSED[0m[31m     [ 53%][0m
tests/unit/test_app_config.py::test_resolve_vars_non_dict_input [32mPASSED[0m[31m   [ 53%][0m
tests/unit/test_app_config.py::test_load_yaml_config_nonexistent_file [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_load_yaml_config_with_temp_file [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_load_yaml_config_invalid_yaml [32mPASSED[0m[31m [ 53%][0m
tests/unit/test_app_config.py::test_load_yaml_config_empty_file [32mPASSED[0m[31m   [ 54%][0m
tests/unit/test_app_config.py::test_load_yaml_config_with_variables [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_app_config.py::test_ensure_config_defaults_empty [32mPASSED[0m[31m  [ 54%][0m
tests/unit/test_app_config.py::test_ensure_config_defaults_preserves_existing [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_app_config.py::test_ensure_config_defaults_adds_missing [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_app_config.py::test_ensure_config_defaults_with_none_values [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_app_config.py::test_resolve_vars_then_defaults [32mPASSED[0m[31m    [ 54%][0m
tests/unit/test_app_config.py::test_complex_nested_config [32mPASSED[0m[31m         [ 54%][0m
tests/unit/test_app_config.py::test_config_with_env_style_variables [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_corpus_manager.py::test_init_no_existing_file [32mPASSED[0m[31m     [ 54%][0m
tests/unit/test_corpus_manager.py::test_init_with_existing_file [32mPASSED[0m[31m   [ 54%][0m
tests/unit/test_corpus_manager.py::test_init_converts_timestamp_strings [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_corpus_manager.py::test_init_handles_corrupt_file [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_corpus_manager.py::test_init_handles_invalid_timestamp [32mPASSED[0m[31m [ 54%][0m
tests/unit/test_corpus_manager.py::test_add_entry_basic [32mPASSED[0m[31m           [ 54%][0m
tests/unit/test_corpus_manager.py::test_add_entry_with_tags [32mPASSED[0m[31m       [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_entry_with_custom_timestamp [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_entry_strips_whitespace [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_entry_with_thread_metadata [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_entry_saves_to_file [32mPASSED[0m[31m   [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_multiple_entries [32mPASSED[0m[31m      [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_recent_memories_basic [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_recent_memories_all [32mPASSED[0m[31m   [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_recent_memories_excludes_summaries [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_recent_memories_empty_corpus [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_summary_string [32mPASSED[0m[31m        [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_summary_with_tags [32mPASSED[0m[31m     [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_summary_with_timestamp [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_add_summary_saves_to_file [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_summaries_basic [32mPASSED[0m[31m       [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_summaries_most_recent_first [32mPASSED[0m[31m [ 55%][0m
tests/unit/test_corpus_manager.py::test_get_summaries_limited_count [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_get_summaries_empty_corpus [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_clean_for_json_datetime [32mPASSED[0m[31m   [ 56%][0m
tests/unit/test_corpus_manager.py::test_clean_for_json_dict_with_datetime [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_clean_for_json_nested_dict [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_clean_for_json_list [32mPASSED[0m[31m       [ 56%][0m
tests/unit/test_corpus_manager.py::test_clean_for_json_primitives [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_clear_corpus_all [32mPASSED[0m[31m          [ 56%][0m
tests/unit/test_corpus_manager.py::test_clear_corpus_keep_summaries [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_prune_corpus_basic [32mPASSED[0m[31m        [ 56%][0m
tests/unit/test_corpus_manager.py::test_prune_corpus_preserve_summaries [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_corpus_manager.py::test_save_corpus_creates_file [32mPASSED[0m[31m  [ 56%][0m
tests/unit/test_corpus_manager.py::test_persistence_roundtrip [32mPASSED[0m[31m     [ 56%][0m
tests/unit/test_corpus_manager.py::test_save_uses_temp_file [32mPASSED[0m[31m       [ 56%][0m
tests/unit/test_corpus_manager.py::test_add_entry_respects_max_entries [32mPASSED[0m[31m [ 56%][0m
tests/unit/test_dependencies.py::test_dependency_container_singleton [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_dependency_container_global_instance [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_initialize_sets_model_manager [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_initialize_idempotent [32mPASSED[0m[31m       [ 57%][0m
tests/unit/test_dependencies.py::test_get_model_manager_before_init [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_get_model_manager_after_init [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_get_tokenizer_manager_before_init [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_get_tokenizer_manager_after_init [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_multiple_instances_share_state [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_initialized_flag_starts_false [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_container_new_method [32mPASSED[0m[31m        [ 57%][0m
tests/unit/test_dependencies.py::test_initialize_creates_tokenizer_manager [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_dependencies.py::test_initialize_with_none [32mPASSED[0m[31m        [ 57%][0m
tests/unit/test_dependencies.py::test_get_manager_error_messages [32mPASSED[0m[31m  [ 57%][0m
tests/unit/test_file_processor.py::test_init_supported_extensions [32mPASSED[0m[31m [ 57%][0m
tests/unit/test_file_processor.py::test_get_supported_extensions [32mPASSED[0m[31m  [ 57%][0m
tests/unit/test_file_processor.py::test_process_files_no_files [32mPASSED[0m[31m    [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_empty_file_list [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_single_txt [32mPASSED[0m[31m  [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_single_py [32mPASSED[0m[31m   [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_single_csv [32mPASSED[0m[31m  [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_multiple [32mPASSED[0m[31m    [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_unsupported_type [32mPASSED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_files_error_handling [31mFAILED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_txt [31mFAILED[0m[31m   [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_py [31mFAILED[0m[31m    [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_csv [31mFAILED[0m[31m   [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_unsupported [31mFAILED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_txt_utf8 [31mFAILED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_empty_txt [31mFAILED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_process_single_file_empty_csv [31mFAILED[0m[31m [ 58%][0m
tests/unit/test_file_processor.py::test_csv_with_special_characters [31mFAILED[0m[31m [ 59%][0m
tests/unit/test_file_processor.py::test_py_file_with_multiline_code [31mFAILED[0m[31m [ 59%][0m
tests/unit/test_file_processor.py::test_process_files_maintains_order [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestPathTraversalProtection::test_blocks_parent_directory_traversal [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestPathTraversalProtection::test_blocks_windows_parent_traversal [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestPathTraversalProtection::test_blocks_absolute_paths [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestPathTraversalProtection::test_blocks_windows_absolute_paths [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestPathTraversalProtection::test_allows_safe_filenames [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestFileSizeLimits::test_blocks_oversized_file [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestFileSizeLimits::test_allows_file_at_size_limit [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestFileSizeLimits::test_blocks_total_size_exceeded [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestFileSizeLimits::test_handles_empty_files [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestCSVFormulaSanitization::test_sanitizes_equals_formula [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestCSVFormulaSanitization::test_sanitizes_plus_formula [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestCSVFormulaSanitization::test_sanitizes_minus_formula [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestCSVFormulaSanitization::test_sanitizes_at_formula [32mPASSED[0m[31m [ 59%][0m
tests/unit/test_file_processor_security.py::TestCSVFormulaSanitization::test_preserves_safe_csv_values [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestInvalidFileHandling::test_handles_missing_name_attribute [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestInvalidFileHandling::test_handles_missing_read_method [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestInvalidFileHandling::test_handles_unsupported_extension [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestTemporaryDirectoryIsolation::test_creates_temporary_directory [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestTemporaryDirectoryIsolation::test_file_not_accessible_after_processing [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestSupportedExtensions::test_returns_copy_of_extensions [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestMultipleFiles::test_processes_multiple_safe_files [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_file_processor_security.py::TestMultipleFiles::test_continues_after_one_malicious_file [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_cache_key_basic [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_cache_key_normalization [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_cache_key_empty [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_cache_key_none [32mPASSED[0m[31m  [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_cache_key_includes_mode [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_cache_wiki_stores_value [32mPASSED[0m[31m [ 60%][0m
tests/unit/test_gate_system_helpers.py::test_cache_wiki_normalizes_query [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_get_cached_wiki_miss [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_cache_wiki_ignores_empty [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_cache_wiki_bounds_size [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_cache_wiki_evicts_oldest [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_what_is [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_who_is [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_tell_me_about [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_with_explain_keyword [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_short_topic [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_deictic_followup [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_long_query [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_empty [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_case_insensitive [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_should_attempt_wiki_short_words_filtered [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_with_category [32mPASSED[0m[31m [ 61%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_with_template [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_with_user [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_with_redirect [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_clean_text [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_with_html [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_empty [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_none [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_high_markup_density [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_looks_wiki_noisy_case_insensitive [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_cache_and_retrieve_workflow [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_multiple_queries_cached [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_attempt_filters_then_cache [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_noisy_content_detection [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_cache_key_consistency [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_basic [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_case_insensitive [32mPASSED[0m[31m [ 62%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_no_article [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_article_in_middle [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_empty_string [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_none [32mPASSED[0m[31m  [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_strip_articles_only_article [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_basic [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_strips_articles [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_capitalization [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_plurals [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_aliases [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_empty [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_deduplication [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_wiki_title_candidates_temporal_cleanup [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_clean_wikiish_headings [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_clean_wikiish_citations [32mPASSED[0m[31m [ 63%][0m
tests/unit/test_gate_system_helpers.py::test_clean_wikiish_templates [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_clean_wikiish_combined [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_clean_wikiish_empty [32mPASSED[0m[31m  [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_content_words_basic [32mPASSED[0m[31m  [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_content_words_lowercase [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_content_words_empty [32mPASSED[0m[31m  [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_content_words_none [32mPASSED[0m[31m   [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_content_words_punctuation [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_full_overlap [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_no_overlap [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_partial [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_empty_query [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_empty_text [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_overlap_score_case_insensitive [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_docs [32mPASSED[0m[31m   [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_wikipedia [32mPASSED[0m[31m [ 64%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_unknown [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_default [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_case_insensitive [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_gate_system_helpers.py::test_source_weight_none [32mPASSED[0m[31m   [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_with_explain [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_with_that [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_with_it [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_with_again [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_negative [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_case_insensitive [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_empty [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_is_deictic_followup_none [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_basic [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_frequency_priority [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_filters_stopwords [32mPASSED[0m[31m [ 65%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_filters_short [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_empty [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_none [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_with_numbers [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_tokens_with_operators [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_with_math [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_no_math [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_empty [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_none [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_only_numbers [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_only_operators [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_mixed [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_num_op_density_high_density [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_its_like [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_imagine [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_as_if [32mPASSED[0m[31m [ 66%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_metaphor [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_multiple [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_none [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_empty [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_none_input [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_analogy_markers_case_insensitive [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_from_last_exchange [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_with_math [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_empty_conv [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_with_numbers [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_maxlen_limit [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_with_derivatives [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_build_anchor_tokens_missing_keys [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_salient_and_anchor_tokens_overlap [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_helpers.py::test_density_and_analogy_for_explanatory_text [32mPASSED[0m[31m [ 67%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_base [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_long_response [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_question_mark [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_confirmation [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_all_confirmations [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_combined_boosts [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_capped_at_one [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_continuity [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_empty_inputs [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_truth_score_case_insensitive [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_base [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_long_content [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_question [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_keywords [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_combined [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_capped [32mPASSED[0m[31m [ 68%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_empty [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_calculate_importance_score_case_insensitive [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_basic [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_truncates [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_missing_query [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_missing_response [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_empty_memory [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_none_values [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_same_memories_same_key [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_get_memory_key_different_memories_different_keys [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_no_manager [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_with_manager [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_manager_returns_none [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_manager_returns_empty [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_manager_raises_exception [32mPASSED[0m[31m [ 69%][0m
tests/unit/test_memory_coordinator_methods.py::test_safe_detect_topic_no_detect_topic_method [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_no_time_manager [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_with_time_manager [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_time_manager_no_current_method [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_time_manager_raises_exception [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_iso_no_time_manager [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_iso_with_time_manager [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_iso_time_manager_no_method [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_now_iso_time_manager_raises_exception [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_truth_score_with_all_factors [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_importance_score_with_all_factors [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_memory_key_uniqueness [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_basic [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_missing_metadata [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_timestamp_parsing [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_invalid_timestamp [32mPASSED[0m[31m [ 70%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_timestamp_already_datetime [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_tags_as_string [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_tags_as_list [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_empty_tags [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_tags_with_whitespace [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_missing_id_generates_uuid [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_query_from_content_fallback [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_default_truth_score [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_none_metadata [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_not_dict_input [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_none_input [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_list_input [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_relevance_score_conversion [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_parse_result_complete_integration [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_basic [32mPASSED[0m[31m [ 71%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_unparseable_content [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_missing_id [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_truth_score_from_metadata [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_no_truth_score [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_timestamp_conversion [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_missing_timestamp [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_empty_content [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_long_content_truncation [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_strips_user_prefix [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_whitespace_stripping [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_multiple_assistant_markers [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_none_metadata [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_missing_metadata [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_missing_tags [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_format_hierarchical_memory_complete_integration [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_explain [32mPASSED[0m[31m [ 72%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_that [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_this [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_again [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_not_deictic [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_none [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_is_deictic_followup_empty [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_basic [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_frequency_based [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_limit_k [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_math_symbols [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_empty [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_salient_tokens_none [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_num_op_density_numbers [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_num_op_density_text_only [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_num_op_density_empty [32mPASSED[0m[31m [ 73%][0m
tests/unit/test_memory_coordinator_methods.py::test_num_op_density_none [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_num_op_density_operators [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_analogy_markers_basic [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_analogy_markers_multiple [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_analogy_markers_none [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_analogy_markers_empty [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_analogy_markers_none_input [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_build_anchor_tokens_basic [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_build_anchor_tokens_math_patterns [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_build_anchor_tokens_empty_conv [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_build_anchor_tokens_maxlen [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_build_anchor_tokens_missing_keys [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_empty_list [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_basic_relevance [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_collection_boost [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_recency_decay [32mPASSED[0m[31m [ 74%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_truth_score_boost [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_importance [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_continuity_recent [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_continuity_token_overlap [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_structural_alignment [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_analogy_penalty [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_deictic_anchor_bonus [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_deictic_penalty_no_anchor [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_tone_penalty [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_timestamp_parsing_string [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_timestamp_invalid [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_missing_timestamp [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_sorts_descending [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_metadata_none [31mFAILED[0m[31m [ 75%][0m
tests/unit/test_memory_coordinator_methods.py::test_rank_memories_missing_scores [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_security_error [32mPASSED[0m[31m [ 75%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_read_error [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_unsupported_type [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_empty_file [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_no_text_extracted [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_size_limit_error [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_ignores_normal_response [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_flags_error_mentioned_in_context [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestFileErrorDetection::test_detects_short_error_response [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestMemoryStorageFiltering::test_skips_storing_file_error [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestMemoryStorageFiltering::test_stores_successful_file_upload [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestMemoryStorageFiltering::test_stores_normal_conversation [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Security error processing /path/file.txt: Path traversal detected: filename contains directory separators]] [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Security error processing /path/file.txt: File object missing 'read()' method]] [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Error reading /path/file.csv: Permission denied]] [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Unsupported file type: virus.exe]] [32mPASSED[0m[31m [ 76%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Empty file: empty.txt]] [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[No text content extracted from blank.docx]] [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_file_error_filter.py::TestErrorPatternCoverage::test_all_error_patterns_detected[[Total file size exceeds limit: 100000000/50000000 bytes]] [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_type_values [32mPASSED[0m[31m      [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_type_count [32mPASSED[0m[31m       [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_type_from_string [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_type_iteration [32mPASSED[0m[31m   [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_node_basic_creation [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_node_default_values [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_node_with_optional_fields [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_memory_node_last_accessed_default [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_basic [32mPASSED[0m[31m           [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_with_metadata [32mPASSED[0m[31m   [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_metadata_serializes_lists [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_metadata_serializes_dicts [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_preserves_simple_values [32mPASSED[0m[31m [ 77%][0m
tests/unit/test_memory_interface.py::test_to_dict_empty_metadata [32mPASSED[0m[31m  [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_basic [32mPASSED[0m[31m         [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_default_values [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_with_tags_list [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_with_tags_json_string [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_tags_invalid_json [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_no_tags [32mPASSED[0m[31m       [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_missing_type [32mPASSED[0m[31m  [ 78%][0m
tests/unit/test_memory_interface.py::test_from_dict_all_memory_types [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_roundtrip_serialization [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_roundtrip_with_complex_metadata [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_roundtrip_all_fields [32mPASSED[0m[31m    [ 78%][0m
tests/unit/test_memory_interface.py::test_memory_node_empty_content [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_memory_node_very_long_content [32mPASSED[0m[31m [ 78%][0m
tests/unit/test_memory_interface.py::test_timestamp_microseconds [32mPASSED[0m[31m  [ 78%][0m
tests/unit/test_memory_interface.py::test_extreme_scores [32mPASSED[0m[31m          [ 79%][0m
tests/unit/test_memory_scorer.py::test_memory_scorer_initialization [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_default [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_long_content [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_with_question [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_important_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_remember_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_note_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_key_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_critical_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_essential_keyword [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_case_insensitive [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_combined_boosts [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_maxed_out [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_empty_string [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_whitespace_only [32mPASSED[0m[31m [ 79%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_multiple_questions [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_keyword_in_middle [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_keyword_multiple_times [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_partial_keyword_match [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_at_boundary_200 [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_at_boundary_201 [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_all_keywords [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_realistic_content [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_very_long_content [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_unicode [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_special_characters [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_calculate_importance_score_numbers [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_basic [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_old_memory [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_access_recency_boost [32mPASSED[0m[31m [ 80%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_importance_score [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_truth_score [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_relevance_score [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_multiple_memories [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_empty_list [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_decay_rate [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_minimum_floor [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_memory_scorer.py::test_apply_temporal_decay_returns_same_list [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_with_thinking [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_no_thinking [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_multiple_lines [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_empty_thinking [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_whitespace [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_none_input [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_empty_string [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_only_opening_tag [32mPASSED[0m[31m [ 81%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_no_opening_tag [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_parse_thinking_block_multiple_closing_tags [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_initialization [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_add_entry_basic [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_add_entry_with_tags [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_get_recent_memories [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_get_recent_zero_limit [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_get_recent_negative_limit [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_get_recent_exceeds_size [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_get_summaries [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_simple_prompt_builder_basic [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_simple_prompt_builder_empty [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_simple_prompt_builder_none [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_simple_prompt_builder_ignores_kwargs [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_initialization [32mPASSED[0m[31m [ 82%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_store_interaction [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_get_memories [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_get_memories_metadata [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_retrieve_relevant_memories [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_retrieve_uses_config [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_retrieve_default_limit [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_get_tone_instructions_high [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_get_tone_instructions_medium [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_get_tone_instructions_concern [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_get_tone_instructions_conversational [31mFAILED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_get_tone_instructions_all_levels_formatted [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_thinking_block_with_tone_context [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_fallback_memory_full_workflow [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_orchestrator_helpers.py::test_in_memory_corpus_ordering [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_string [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_dict_content [32mPASSED[0m[31m [ 83%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_dict_text [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_dict_response [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_dict_filtered_content [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_key_priority [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_dict_no_keys [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_empty_dict [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_none [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_number [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_from_list [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_text_empty_string_values [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_with_query_response [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_with_content [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_with_timestamp [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_without_timestamp [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_empty_query_response [32mPASSED[0m[31m [ 84%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_whitespace_stripping [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_fallback_to_str [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_format_memory_content_with_timestamp [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_get_time_context_format [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_get_time_context_year [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_get_time_context_format_structure [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_extract_and_format_workflow [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_time_context_in_prompt [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_builder_methods.py::test_memory_formatting_with_various_types [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_true_values [32mPASSED[0m[31m    [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_false_values [32mPASSED[0m[31m   [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_none [32mPASSED[0m[31m           [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_invalid_returns_false [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_whitespace [32mPASSED[0m[31m     [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_empty_string [32mPASSED[0m[31m   [ 85%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_case_insensitive [32mPASSED[0m[31m [ 85%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_basic [32mPASSED[0m[31m     [ 86%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_with_timestamp [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_without_timestamp [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_empty_tags [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_multiple_tags [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_as_summary_dict_empty_content [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_basic [32mPASSED[0m[31m   [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_case_insensitive [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_with_whitespace [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_empty_list [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_single_item [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_no_duplicates [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_all_duplicates [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_custom_key_fn [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_keep_order_keeps_empty_keys [32mPASSED[0m[31m [ 86%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_within_limit [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_exceeds_limit [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_exact_limit [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_empty [32mPASSED[0m[31m       [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_zero_limit [32mPASSED[0m[31m  [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_negative_limit [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_single_item [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_list_preserves_types [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_cfg_int_returns_int [32mPASSED[0m[31m       [ 87%][0m
tests/unit/test_prompt_helpers.py::test_cfg_int_with_default [32mPASSED[0m[31m      [ 87%][0m
tests/unit/test_prompt_helpers.py::test_cfg_int_default_zero [32mPASSED[0m[31m      [ 87%][0m
tests/unit/test_prompt_helpers.py::test_cfg_int_default_negative [32mPASSED[0m[31m  [ 87%][0m
tests/unit/test_prompt_helpers.py::test_dedupe_and_truncate_workflow [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_parse_bool_for_feature_flags [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_summary_dict_with_dedupe_tags [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_prompt_helpers.py::test_truncate_preserves_dedupe_order [32mPASSED[0m[31m [ 87%][0m
tests/unit/test_query_checker.py::test_normalize_basic [32mPASSED[0m[31m            [ 88%][0m
tests/unit/test_query_checker.py::test_normalize_strips_whitespace [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_query_checker.py::test_normalize_empty_string [32mPASSED[0m[31m     [ 88%][0m
tests/unit/test_query_checker.py::test_normalize_none [32mPASSED[0m[31m             [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_question_mark [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_how [32mPASSED[0m[31m       [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_what [32mPASSED[0m[31m      [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_who [32mPASSED[0m[31m       [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_when [32mPASSED[0m[31m      [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_where [32mPASSED[0m[31m     [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_why [32mPASSED[0m[31m       [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_with_which [32mPASSED[0m[31m     [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_negative [32mPASSED[0m[31m       [ 88%][0m
tests/unit/test_query_checker.py::test_is_question_case_insensitive [32mPASSED[0m[31m [ 88%][0m
tests/unit/test_query_checker.py::test_is_command_with_slash [32mPASSED[0m[31m      [ 88%][0m
tests/unit/test_query_checker.py::test_is_command_with_please [32mPASSED[0m[31m     [ 88%][0m
tests/unit/test_query_checker.py::test_is_command_with_do [32mPASSED[0m[31m         [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_with_create [32mPASSED[0m[31m     [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_with_generate [32mPASSED[0m[31m   [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_with_write [32mPASSED[0m[31m      [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_with_summarize [32mPASSED[0m[31m  [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_negative [32mPASSED[0m[31m        [ 89%][0m
tests/unit/test_query_checker.py::test_is_command_case_insensitive [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_short_with_that [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_short_with_explain [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_starts_with_that [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_starts_with_this [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_starts_with_it [32mPASSED[0m[31m  [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_negative_long_sentence [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_negative_no_markers [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_followup_with_explain [32mPASSED[0m[31m [ 89%][0m
tests/unit/test_query_checker.py::test_is_deictic_followup_with_elaborate [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_deictic_followup_with_more [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_deictic_followup_negative [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_do_you_recall [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_do_you_remember [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_did_we [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_we_discussed [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_you_said [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_you_mentioned [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_last_time [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_is_meta_conversational_negative [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_yesterday [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_last_night [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_days_ago [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_last_week [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_last_month [32mPASSED[0m[31m [ 90%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_specific_day [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_no_markers [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_empty [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_explicit_number [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_explicit_date [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_temporal_window_multiple_markers [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_keyword_tokens_basic [32mPASSED[0m[31m       [ 91%][0m
tests/unit/test_query_checker.py::test_keyword_tokens_filters_short [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_keyword_tokens_custom_min_length [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_keyword_tokens_case_insensitive [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_keyword_tokens_empty [32mPASSED[0m[31m       [ 91%][0m
tests/unit/test_query_checker.py::test_extract_thread_keywords_basic [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_thread_keywords_filters_stopwords [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_thread_keywords_filters_short [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_extract_thread_keywords_punctuation [32mPASSED[0m[31m [ 91%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_changing_topics [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_different_topic [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_switching_gears [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_anyway [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_moving_on [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_has_thread_break_marker_negative [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_thread_continuity_hard_cutoff [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_thread_continuity_explicit_break [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_thread_continuity_keyword_overlap [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_thread_continuity_heavy_topics_both [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_thread_continuity_same_topic_bonus [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_long_text [32mPASSED[0m[31m      [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_multiple_keywords [32mPASSED[0m[31m [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_mental_health [32mPASSED[0m[31m  [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_crisis [32mPASSED[0m[31m         [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_normal_text [32mPASSED[0m[31m    [ 92%][0m
tests/unit/test_query_checker.py::test_heavy_topic_empty [32mPASSED[0m[31m          [ 93%][0m
tests/unit/test_query_checker.py::test_heavy_topic_none [32mPASSED[0m[31m           [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_heavy [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_normal [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_heavy_lowercase [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_normal_lowercase [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_with_extra_text [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_crisis [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_empty [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_parse_heavy_topic_response_none [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_question [32mPASSED[0m[31m     [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_command [32mPASSED[0m[31m      [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_deictic [32mPASSED[0m[31m      [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_meta_conversational [32mPASSED[0m[31m [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_statement [32mPASSED[0m[31m    [ 93%][0m
tests/unit/test_query_checker.py::test_analyze_query_heavy_topic [32mPASSED[0m[31m  [ 94%][0m
tests/unit/test_query_checker.py::test_analyze_query_normal_topic [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_query_checker.py::test_belongs_to_thread_recent_same_keywords [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_query_checker.py::test_belongs_to_thread_too_old [32mPASSED[0m[31m  [ 94%][0m
tests/unit/test_query_checker.py::test_belongs_to_thread_explicit_break [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_query_checker.py::test_belongs_to_thread_different_topics [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_time_manager.py::test_init_no_existing_file [32mPASSED[0m[31m       [ 94%][0m
tests/unit/test_time_manager.py::test_init_with_existing_file [32mPASSED[0m[31m     [ 94%][0m
tests/unit/test_time_manager.py::test_init_with_corrupted_file [32mPASSED[0m[31m    [ 94%][0m
tests/unit/test_time_manager.py::test_init_with_missing_key [32mPASSED[0m[31m       [ 94%][0m
tests/unit/test_time_manager.py::test_init_with_invalid_timestamp [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_time_manager.py::test_current_returns_datetime [32mPASSED[0m[31m    [ 94%][0m
tests/unit/test_time_manager.py::test_current_is_recent [32mPASSED[0m[31m           [ 94%][0m
tests/unit/test_time_manager.py::test_current_iso_format [32mPASSED[0m[31m          [ 94%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_no_previous [32mPASSED[0m[31m [ 94%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_seconds [32mPASSED[0m[31m  [ 94%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_minutes [32mPASSED[0m[31m  [ 95%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_hours [32mPASSED[0m[31m    [ 95%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_days [32mPASSED[0m[31m     [ 95%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_just_under_minute [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_elapsed_since_last_exactly_one_minute [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_mark_query_time_sets_timestamp [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_mark_query_time_saves_to_file [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_mark_query_time_returns_timestamp [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_measure_response_basic [32mPASSED[0m[31m      [ 95%][0m
tests/unit/test_time_manager.py::test_measure_response_subsecond [32mPASSED[0m[31m  [ 95%][0m
tests/unit/test_time_manager.py::test_measure_response_long_duration [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_measure_response_zero_duration [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_last_response_no_previous [32mPASSED[0m[31m   [ 95%][0m
tests/unit/test_time_manager.py::test_last_response_with_previous [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_last_response_after_multiple_measurements [32mPASSED[0m[31m [ 95%][0m
tests/unit/test_time_manager.py::test_persistence_roundtrip [32mPASSED[0m[31m       [ 96%][0m
tests/unit/test_time_manager.py::test_save_only_when_time_set [32mPASSED[0m[31m     [ 96%][0m
tests/unit/test_time_manager.py::test_multiple_marks_update_file [32mPASSED[0m[31m  [ 96%][0m
tests/unit/test_tone_detector.py::test_tone_config_exists [32mPASSED[0m[31m         [ 96%][0m
tests/unit/test_tone_detector.py::test_tone_config_thresholds_ordered [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_tone_config_values_reasonable [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_crisis_level_enum [32mPASSED[0m[31m          [ 96%][0m
tests/unit/test_tone_detector.py::test_crisis_level_ordering [32mPASSED[0m[31m      [ 96%][0m
tests/unit/test_tone_detector.py::test_tone_analysis_creation [32mPASSED[0m[31m     [ 96%][0m
tests/unit/test_tone_detector.py::test_high_crisis_keywords_not_empty [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_medium_crisis_keywords_not_empty [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_concern_keywords_not_empty [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_observational_markers_not_empty [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_keyword_sets_are_lowercase [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_multiple_markers [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_news_and_people [32mPASSED[0m[31m [ 96%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_third_person_only [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_personal_statement [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_single_marker [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_empty [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_observational_language_first_person_beats_third [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_high_suicide [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_high_kill_myself [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_medium_panic [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_medium_breakdown [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_concern_anxious [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_concern_scared [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_no_match [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_case_insensitive [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_empty [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_partial_match [32mPASSED[0m[31m [ 97%][0m
tests/unit/test_tone_detector.py::test_check_keyword_crisis_high_beats_medium [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_log_basic [32mPASSED[0m[31m      [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_log_high_crisis [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_log_includes_message_preview [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_to_high [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_to_medium [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_to_concern [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_same_level [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_escalation [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_deescalation [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_should_log_tone_shift_from_conversational_to_high [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_shift_log_escalation [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_shift_log_deescalation [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_format_tone_shift_log_with_trigger [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_keyword_detection_comprehensive [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_personal_distress_detection [32mPASSED[0m[31m [ 98%][0m
tests/unit/test_tone_detector.py::test_multiple_crisis_keywords [32mPASSED[0m[31m   [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_create_and_save [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_categorization [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_conflict_resolution [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_batch_add [32mPASSED[0m[31m  [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_markdown_export [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_context_injection [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_quick_profile_normalization [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_supersedes_tracking [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_hybrid_retrieval [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile.py::TestUserProfile::test_context_injection_with_query [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile_schema.py::TestProfileSchema::test_categorize_known_relations [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile_schema.py::TestProfileSchema::test_categorize_heuristic_fallback [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile_schema.py::TestProfileSchema::test_profile_fact_serialization [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile_schema.py::TestProfileSchema::test_all_categories_exist [32mPASSED[0m[31m [ 99%][0m
tests/unit/test_user_profile_schema.py::TestProfileSchema::test_relation_map_completeness [32mPASSED[0m[31m [100%][0m

==================================== ERRORS ====================================
[31m[1m__________ ERROR at setup of test_gated_prompt_builder_initialization __________[0m
[1m[31mtests/test_integration_gate_system.py[0m:55: in prompt_builder
    [0m[94mreturn[39;49;00m PromptBuilder([90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1352: in __init__
    [0m[96mself[39;49;00m.unified_builder = UnifiedPromptBuilder([90m[39;49;00m
[1m[31mE   TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values for keyword argument 'memory_coordinator'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpegphaf29/corpus.json
[31m[1m______________ ERROR at setup of test_gated_prompt_builder_basic _______________[0m
[1m[31mtests/test_integration_gate_system.py[0m:55: in prompt_builder
    [0m[94mreturn[39;49;00m PromptBuilder([90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1352: in __init__
    [0m[96mself[39;49;00m.unified_builder = UnifiedPromptBuilder([90m[39;49;00m
[1m[31mE   TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values for keyword argument 'memory_coordinator'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpd7pfpj78/corpus.json
[31m[1m__________ ERROR at setup of test_gated_prompt_builder_with_memories ___________[0m
[1m[31mtests/test_integration_gate_system.py[0m:55: in prompt_builder
    [0m[94mreturn[39;49;00m PromptBuilder([90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1352: in __init__
    [0m[96mself[39;49;00m.unified_builder = UnifiedPromptBuilder([90m[39;49;00m
[1m[31mE   TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values for keyword argument 'memory_coordinator'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmp5s6073g_/corpus.json
[31m[1m_____________ ERROR at setup of test_gated_prompt_integration_flow _____________[0m
[1m[31mtests/test_integration_gate_system.py[0m:55: in prompt_builder
    [0m[94mreturn[39;49;00m PromptBuilder([90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1352: in __init__
    [0m[96mself[39;49;00m.unified_builder = UnifiedPromptBuilder([90m[39;49;00m
[1m[31mE   TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values for keyword argument 'memory_coordinator'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpz2v8_tqx/corpus.json
[31m[1m__________________ ERROR at setup of test_full_query_workflow __________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_____________ ERROR at setup of test_memory_retrieval_with_topics ______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_______________ ERROR at setup of test_memory_relevance_scoring ________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_______________ ERROR at setup of test_prompt_building_workflow ________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m________________ ERROR at setup of test_memory_with_empty_query ________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m____________ ERROR at setup of test_memory_with_special_characters _____________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m___________ ERROR at setup of test_multiple_sequential_interactions ____________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_________________ ERROR at setup of test_memory_with_long_text _________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m__________ ERROR at setup of test_prompt_builder_with_empty_memories ___________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_____________ ERROR at setup of test_memory_consolidation_trigger ______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m________________ ERROR at setup of test_gate_system_integration ________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m______________ ERROR at setup of test_memory_with_tags_filtering _______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_____________ ERROR at setup of test_concurrent_memory_operations ______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_____________ ERROR at setup of test_prompt_builder_token_limiting _____________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m________________ ERROR at setup of test_memory_recent_retrieval ________________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m______________ ERROR at setup of test_memory_with_unicode_content ______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_______________ ERROR at setup of test_memory_scorer_integration _______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
[31m[1m_____________ ERROR at setup of test_memory_retrieval_with_config ______________[0m
[1m[31mtests/test_integration_workflows.py[0m:65: in memory_coordinator
    [0mchroma_store = MultiCollectionChromaStore(path=temp_chroma_dir)[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword argument 'path'[0m
=================================== FAILURES ===================================
[31m[1m___________________________ test_active_day_tracking ___________________________[0m
[1m[31mtests/test_active_day_decay.py[0m:79: in test_active_day_tracking
    [0m[94massert[39;49;00m active_days_3 == [94m2[39;49;00m, [33mf[39;49;00m[33m"[39;49;00m[33mExpected 2 active days, got [39;49;00m[33m{[39;49;00mactive_days_3[33m}[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected 2 active days, got 5[0m
[1m[31mE   assert 5 == 2[0m
----------------------------- Captured stdout call -----------------------------
=== Testing Active Day Tracking ===
Day 1 - Active days since 2025-11-27: 4
Registered active days: ['2025-11-26', '2025-11-27', '2025-11-28', '2025-11-30', '2025-12-03', '2025-12-04']
Today is: 2025-12-04
Day 3 - Active days since 2025-11-27: 5
[31m[1m____________________________ test_fallback_behavior ____________________________[0m
[1m[31mtests/test_active_day_decay.py[0m:233: in test_fallback_behavior
    [0mresult = scorer_no_time_manager.apply_temporal_decay([mem_dict])[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mmemory/memory_scorer.py[0m:440: in apply_temporal_decay
    [0mage_hours = (now - timestamp).total_seconds() / [94m3600.0[39;49;00m[90m[39;49;00m
                 ^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: unsupported operand type(s) for -: 'datetime.datetime' and 'NoneType'[0m
----------------------------- Captured stdout call -----------------------------
=== Testing Fallback Behavior ===
[31m[1m_________________________ test_competitive_vs_baseline _________________________[0m
[1m[31mtests/test_competitive_prototype.py[0m:45: in test_competitive_vs_baseline
    [0mcontext_baseline = [94mawait[39;49;00m builder._gather_context([90m[39;49;00m
[1m[31mE   TypeError: UnifiedPromptBuilder._gather_context() got an unexpected keyword argument 'include_dreams'[0m
----------------------------- Captured stdout call -----------------------------
🔧 Initializing components...

================================================================================
QUESTION 1: What are the key facts about machine learning?
================================================================================

📦 Gathering context...
------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:184 No memory coordinator provided, using fallback
[31m[1m__________________________ test_get_facts_empty_query __________________________[0m
[1m[31mtests/test_edge_cases_comprehensive.py[0m:263: in test_get_facts_empty_query
    [0mfacts = [94mawait[39;49;00m prompt_builder.get_facts(query=[33m"[39;49;00m[33m"[39;49;00m, limit=[94m8[39;49;00m)[90m[39;49;00m
                  ^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpvv05_jx_/corpus.json
[31m[1m____________________________ test_get_facts_unicode ____________________________[0m
[1m[31mtests/test_edge_cases_comprehensive.py[0m:270: in test_get_facts_unicode
    [0mfacts = [94mawait[39;49;00m prompt_builder.get_facts(query=[33m"[39;49;00m[33mPython 编程[39;49;00m[33m"[39;49;00m, limit=[94m8[39;49;00m)[90m[39;49;00m
                  ^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmp3ah66u9s/corpus.json
[31m[1m________________________________ test_full_flow ________________________________[0m
[1m[31mtests/test_full_meta_query.py[0m:18: in test_full_flow
    [0morchestrator = DaemonOrchestrator()[90m[39;49;00m
                   ^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: DaemonOrchestrator.__init__() missing 4 required keyword-only arguments: 'model_manager', 'response_generator', 'file_processor', and 'prompt_builder'[0m
----------------------------- Captured stdout call -----------------------------

======================================================================
Full End-to-End Test: Meta-Conversational Query
======================================================================

Initializing orchestrator...
[31m[1m______________________________ test_gated_builder ______________________________[0m
[1m[31mtests/test_gated_prompt.py[0m:27: in test_gated_builder
    [0mprompt = [94mawait[39;49;00m gated_pb.build_gated_prompt([90m[39;49;00m
[1m[31mutils/logging_utils.py[0m:98: in async_func_wrapper
    [0mresult = [94mawait[39;49;00m func(*args, **kwargs)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mprocessing/gate_system.py[0m:1353: in build_gated_prompt
    [0mfinal_prompt = [96mself[39;49;00m.prompt_builder._assemble_prompt([90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1379: in _assemble_prompt
    [0m[94mreturn[39;49;00m [96mself[39;49;00m.unified_builder._assemble_prompt(context, user_input, directives)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1087: in _assemble_prompt
    [0mlogger.warning([33mf[39;49;00m[33m"[39;49;00m[33mPROMPT ASSEMBLY START: context has [39;49;00m[33m{[39;49;00m[96mlen[39;49;00m(context)[33m}[39;49;00m[33m keys: [39;49;00m[33m{[39;49;00m[96mlist[39;49;00m(context.keys())[33m}[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
                                                                                   ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'str' object has no attribute 'keys'[0m
----------------------------- Captured stdout call -----------------------------
Building gated prompt...

------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:184 No memory coordinator provided, using fallback
[33mWARNING [0m prompt_builder:builder.py:1087 PROMPT ASSEMBLY START: context has 8 keys: ['recent_conversations', 'memories', 'user_profile', 'summaries', 'reflections', 'dreams', 'semantic_chunks', 'wiki']
[33mWARNING [0m prompt_builder:builder.py:1088 PROMPT ASSEMBLY START: recent_summaries=0, semantic_summaries=0
[33mWARNING [0m prompt_builder:builder.py:1089 PROMPT ASSEMBLY START: stm_summary present = False, value = None
[33mWARNING [0m prompt_builder:builder.py:1167 PROMPT BUILD: FINAL COUNT - Got 3 memories from context BEFORE ASSEMBLY
[33mWARNING [0m prompt_builder:builder.py:1174 PROMPT BUILD: FINAL COUNT - [RELEVANT MEMORIES] section will contain 3 memories
[33mWARNING [0m prompt_builder:builder.py:1185 PROMPT ASSEMBLY: Got 0 recent summaries
[33mWARNING [0m prompt_builder:builder.py:1200 PROMPT ASSEMBLY: No recent summaries to add
[33mWARNING [0m prompt_builder:builder.py:1291 STM RENDERING CHECK: stm_summary = None
[33mWARNING [0m prompt_builder:builder.py:1311 STM RENDERING: No stm_summary in context, skipping section
[31m[1m________________________________ test_get_facts ________________________________[0m
[1m[31mtests/test_integration_prompt_advanced.py[0m:70: in test_get_facts
    [0mfacts = [94mawait[39;49;00m prompt_builder.get_facts([33m"[39;49;00m[33mPython programming[39;49;00m[33m"[39;49;00m, limit=[94m5[39;49;00m)[90m[39;49;00m
                  ^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmptkb1iep_/corpus.json
[31m[1m____________________________ test_get_recent_facts _____________________________[0m
[1m[31mtests/test_integration_prompt_advanced.py[0m:79: in test_get_recent_facts
    [0mfacts = [94mawait[39;49;00m prompt_builder.get_recent_facts(limit=[94m3[39;49;00m)[90m[39;49;00m
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_recent_facts'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmptjz05j_f/corpus.json
[31m[1m_____________________________ test_get_token_count _____________________________[0m
[1m[31mtests/test_integration_prompt_advanced.py[0m:170: in test_get_token_count
    [0mcount = prompt_builder.get_token_count(text, model_name=[33m"[39;49;00m[33mgpt-4[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mcore/prompt/builder.py[0m:1067: in get_token_count
    [0m[94mreturn[39;49;00m [96mself[39;49;00m.token_manager.get_token_count(text, model_name)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mcore/prompt/token_manager.py[0m:83: in get_token_count
    [0m[94mreturn[39;49;00m [96mself[39;49;00m.tokenizer_manager.count_tokens(text [95mor[39;49;00m [33m"[39;49;00m[33m"[39;49;00m, model_name)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'NoneType' object has no attribute 'count_tokens'[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpkxkpevdw/corpus.json
[31m[1m___________________________ test_build_prompt_basic ____________________________[0m
[1m[31mtests/test_integration_prompt_builder.py[0m:65: in test_build_prompt_basic
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mcurrent_topic[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mfacts[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mrecent[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'facts' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'recent' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...})[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpixwj1lc5/corpus.json
------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:232 SMALL_TALK CHECK: is_small_talk=False
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m prompt_context_gatherer:context_gatherer.py:431 [CONTEXT_GATHERER] NO MEMORIES RETURNED from coordinator despite successful call!
[33mWARNING [0m prompt_builder:builder.py:309 CONTEXT GATHERING: summaries_data = {'recent': [], 'semantic': []}, type = <class 'dict'>
[33mWARNING [0m prompt_builder:builder.py:314 CONTEXT GATHERING: Extracted 0 recent, 0 semantic summaries
[33mWARNING [0m prompt_builder:builder.py:381 [DEBUG] recent_conversations has 0 items
[33mWARNING [0m prompt_builder:builder.py:400 CONTEXT BUILT: recent_summaries=0, semantic_summaries=0, recent_reflections=0, semantic_reflections=0
[33mWARNING [0m prompt_builder:builder.py:426 BEFORE HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:428 AFTER HYGIENE_AND_CAPS: context has 12 keys: ['recent_conversations', 'memories', 'user_profile', 'summaries', 'recent_summaries', 'semantic_summaries', 'reflections', 'recent_reflections', 'semantic_reflections', 'dreams', 'semantic_chunks', 'wiki']
[33mWARNING [0m prompt_builder:builder.py:429 AFTER HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:430 AFTER HYGIENE_AND_CAPS: recent_summaries=0, semantic_summaries=0
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m prompt_builder:builder.py:455 AFTER MEMORY TOP-UP: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:459 START OF SUMMARIES BLOCK: memories count = 0, context id = 140028753122496
[33mWARNING [0m prompt_builder:builder.py:466 BEFORE get_summaries: memories count = 0, context id = 140028753122496
[33mWARNING [0m prompt_builder:builder.py:470 AFTER get_summaries: memories count = 0, context id = 140028753122496, stored type = <class 'list'>
[33mWARNING [0m prompt_builder:builder.py:535 BEFORE TOKEN BUDGET: memories count = 0
[33mWARNING [0m prompt_token_manager:token_manager.py:162 [TOKEN BUDGET] Processing section 'semantic_chunks' with 8 items, current_tokens=0
[1m[31mERROR   [0m prompt_builder:builder.py:652 Prompt building failed: 'NoneType' object has no attribute 'count_tokens'
[1m[31mERROR   [0m prompt_builder:builder.py:654 Traceback: Traceback (most recent call last):
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/builder.py", line 536, in build_prompt
    context = self.token_manager._manage_token_budget(context)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 168, in _manage_token_budget
    t = self.get_token_count(item_text, model_name)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 83, in get_token_count
    return self.tokenizer_manager.count_tokens(text or "", model_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'count_tokens'
[31m[1m_______________________ test_build_prompt_with_memories ________________________[0m
[1m[31mtests/test_integration_prompt_builder.py[0m:85: in test_build_prompt_with_memories
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mcurrent_topic[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mfacts[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mrecent[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'facts' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'recent' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...})[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpsdkk2jya/corpus.json
------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:232 SMALL_TALK CHECK: is_small_talk=False
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m prompt_context_gatherer:context_gatherer.py:471 Memory scoring fallback failed: unhashable type: 'dict'
[33mWARNING [0m prompt_builder:builder.py:309 CONTEXT GATHERING: summaries_data = {'recent': [], 'semantic': []}, type = <class 'dict'>
[33mWARNING [0m prompt_builder:builder.py:314 CONTEXT GATHERING: Extracted 0 recent, 0 semantic summaries
[33mWARNING [0m prompt_summarizer:summarizer.py:400 On-demand reflection failed: ModelManager.generate() got an unexpected keyword argument 'model'
[33mWARNING [0m prompt_builder:builder.py:381 [DEBUG] recent_conversations has 3 items
[33mWARNING [0m prompt_builder:builder.py:383 [DEBUG] First recent: What is Python?...
[33mWARNING [0m prompt_builder:builder.py:384 [DEBUG] Last recent: What is Python?...
[33mWARNING [0m prompt_builder:builder.py:400 CONTEXT BUILT: recent_summaries=0, semantic_summaries=0, recent_reflections=0, semantic_reflections=0
[33mWARNING [0m prompt_builder:builder.py:426 BEFORE HYGIENE_AND_CAPS: memories count = 2
[33mWARNING [0m prompt_builder:builder.py:428 AFTER HYGIENE_AND_CAPS: context has 12 keys: ['recent_conversations', 'memories', 'user_profile', 'summaries', 'recent_summaries', 'semantic_summaries', 'reflections', 'recent_reflections', 'semantic_reflections', 'dreams', 'semantic_chunks', 'wiki']
[33mWARNING [0m prompt_builder:builder.py:429 AFTER HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:430 AFTER HYGIENE_AND_CAPS: recent_summaries=0, semantic_summaries=0
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m prompt_builder:builder.py:455 AFTER MEMORY TOP-UP: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:459 START OF SUMMARIES BLOCK: memories count = 0, context id = 140028752974016
[33mWARNING [0m prompt_builder:builder.py:466 BEFORE get_summaries: memories count = 0, context id = 140028752974016
[33mWARNING [0m prompt_builder:builder.py:470 AFTER get_summaries: memories count = 0, context id = 140028752974016, stored type = <class 'list'>
[33mWARNING [0m prompt_builder:builder.py:535 BEFORE TOKEN BUDGET: memories count = 0
[33mWARNING [0m prompt_token_manager:token_manager.py:162 [TOKEN BUDGET] Processing section 'recent_conversations' with 2 items, current_tokens=0
[1m[31mERROR   [0m prompt_builder:builder.py:652 Prompt building failed: 'NoneType' object has no attribute 'count_tokens'
[1m[31mERROR   [0m prompt_builder:builder.py:654 Traceback: Traceback (most recent call last):
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/builder.py", line 536, in build_prompt
    context = self.token_manager._manage_token_budget(context)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 168, in _manage_token_budget
    t = self.get_token_count(item_text, model_name)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 83, in get_token_count
    return self.tokenizer_manager.count_tokens(text or "", model_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'count_tokens'
[31m[1m_____________________ test_build_prompt_with_search_query ______________________[0m
[1m[31mtests/test_integration_prompt_builder.py[0m:97: in test_build_prompt_with_search_query
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mcurrent_topic[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mfacts[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mrecent[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'facts' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'recent' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...})[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmp7lvjjy72/corpus.json
------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:232 SMALL_TALK CHECK: is_small_talk=False
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m prompt_context_gatherer:context_gatherer.py:431 [CONTEXT_GATHERER] NO MEMORIES RETURNED from coordinator despite successful call!
[33mWARNING [0m prompt_builder:builder.py:309 CONTEXT GATHERING: summaries_data = {'recent': [], 'semantic': []}, type = <class 'dict'>
[33mWARNING [0m prompt_builder:builder.py:314 CONTEXT GATHERING: Extracted 0 recent, 0 semantic summaries
[33mWARNING [0m prompt_builder:builder.py:381 [DEBUG] recent_conversations has 0 items
[33mWARNING [0m prompt_builder:builder.py:400 CONTEXT BUILT: recent_summaries=0, semantic_summaries=0, recent_reflections=0, semantic_reflections=0
[33mWARNING [0m prompt_builder:builder.py:426 BEFORE HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:428 AFTER HYGIENE_AND_CAPS: context has 12 keys: ['recent_conversations', 'memories', 'user_profile', 'summaries', 'recent_summaries', 'semantic_summaries', 'reflections', 'recent_reflections', 'semantic_reflections', 'dreams', 'semantic_chunks', 'wiki']
[33mWARNING [0m prompt_builder:builder.py:429 AFTER HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:430 AFTER HYGIENE_AND_CAPS: recent_summaries=0, semantic_summaries=0
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 0 results after relaxation, taking top 5
[33mWARNING [0m prompt_builder:builder.py:455 AFTER MEMORY TOP-UP: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:459 START OF SUMMARIES BLOCK: memories count = 0, context id = 140028753549376
[33mWARNING [0m prompt_builder:builder.py:466 BEFORE get_summaries: memories count = 0, context id = 140028753549376
[33mWARNING [0m prompt_builder:builder.py:470 AFTER get_summaries: memories count = 0, context id = 140028753549376, stored type = <class 'list'>
[33mWARNING [0m prompt_builder:builder.py:535 BEFORE TOKEN BUDGET: memories count = 0
[33mWARNING [0m prompt_token_manager:token_manager.py:162 [TOKEN BUDGET] Processing section 'semantic_chunks' with 11 items, current_tokens=0
[1m[31mERROR   [0m prompt_builder:builder.py:652 Prompt building failed: 'NoneType' object has no attribute 'count_tokens'
[1m[31mERROR   [0m prompt_builder:builder.py:654 Traceback: Traceback (most recent call last):
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/builder.py", line 536, in build_prompt
    context = self.token_manager._manage_token_budget(context)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 168, in _manage_token_budget
    t = self.get_token_count(item_text, model_name)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 83, in get_token_count
    return self.tokenizer_manager.count_tokens(text or "", model_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'count_tokens'
[31m[1m____________________ test_prompt_builder_memory_integration ____________________[0m
[1m[31mtests/test_integration_prompt_builder.py[0m:162: in test_prompt_builder_memory_integration
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mcurrent_topic[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mfacts[39;49;00m[33m"[39;49;00m [95min[39;49;00m result [95mor[39;49;00m [33m"[39;49;00m[33mrecent[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'facts' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...} or 'recent' in {'dreams': [], 'memories': [], 'recent_conversations': [], 'reflections': [], ...})[0m
------------------------------ Captured log setup ------------------------------
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpa24dt36f/corpus.json
------------------------------ Captured log call -------------------------------
[33mWARNING [0m prompt_builder:builder.py:232 SMALL_TALK CHECK: is_small_talk=False
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m prompt_context_gatherer:context_gatherer.py:471 Memory scoring fallback failed: unhashable type: 'dict'
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m prompt_builder:builder.py:309 CONTEXT GATHERING: summaries_data = {'recent': [], 'semantic': []}, type = <class 'dict'>
[33mWARNING [0m prompt_builder:builder.py:314 CONTEXT GATHERING: Extracted 0 recent, 0 semantic summaries
[33mWARNING [0m prompt_summarizer:summarizer.py:400 On-demand reflection failed: ModelManager.generate() got an unexpected keyword argument 'model'
[33mWARNING [0m prompt_builder:builder.py:381 [DEBUG] recent_conversations has 3 items
[33mWARNING [0m prompt_builder:builder.py:383 [DEBUG] First recent: What are neural networks?...
[33mWARNING [0m prompt_builder:builder.py:384 [DEBUG] Last recent: What are neural networks?...
[33mWARNING [0m prompt_builder:builder.py:400 CONTEXT BUILT: recent_summaries=0, semantic_summaries=0, recent_reflections=0, semantic_reflections=0
[33mWARNING [0m prompt_builder:builder.py:426 BEFORE HYGIENE_AND_CAPS: memories count = 2
[33mWARNING [0m prompt_builder:builder.py:428 AFTER HYGIENE_AND_CAPS: context has 12 keys: ['recent_conversations', 'memories', 'user_profile', 'summaries', 'recent_summaries', 'semantic_summaries', 'reflections', 'recent_reflections', 'semantic_reflections', 'dreams', 'semantic_chunks', 'wiki']
[33mWARNING [0m prompt_builder:builder.py:429 AFTER HYGIENE_AND_CAPS: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:430 AFTER HYGIENE_AND_CAPS: recent_summaries=0, semantic_summaries=0
[33mWARNING [0m memory_retriever:memory_retriever.py:756 [Retrieval] Still only 2 results after relaxation, taking top 5
[33mWARNING [0m prompt_builder:builder.py:455 AFTER MEMORY TOP-UP: memories count = 0
[33mWARNING [0m prompt_builder:builder.py:459 START OF SUMMARIES BLOCK: memories count = 0, context id = 140027209915712
[33mWARNING [0m prompt_builder:builder.py:466 BEFORE get_summaries: memories count = 0, context id = 140027209915712
[33mWARNING [0m prompt_builder:builder.py:470 AFTER get_summaries: memories count = 0, context id = 140027209915712, stored type = <class 'list'>
[33mWARNING [0m prompt_builder:builder.py:535 BEFORE TOKEN BUDGET: memories count = 0
[33mWARNING [0m prompt_token_manager:token_manager.py:162 [TOKEN BUDGET] Processing section 'recent_conversations' with 2 items, current_tokens=0
[1m[31mERROR   [0m prompt_builder:builder.py:652 Prompt building failed: 'NoneType' object has no attribute 'count_tokens'
[1m[31mERROR   [0m prompt_builder:builder.py:654 Traceback: Traceback (most recent call last):
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/builder.py", line 536, in build_prompt
    context = self.token_manager._manage_token_budget(context)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 168, in _manage_token_budget
    t = self.get_token_count(item_text, model_name)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lukeh/Daemon_RAG_Agent_working/core/prompt/token_manager.py", line 83, in get_token_count
    return self.tokenizer_manager.count_tokens(text or "", model_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'count_tokens'
[31m[1m________________________ test_time_manager_integration _________________________[0m
[1m[31mtests/test_integration_workflows.py[0m:259: in test_time_manager_integration
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(elapsed, [96mfloat[39;49;00m)[90m[39;49;00m
[1m[31mE   AssertionError: assert False[0m
[1m[31mE    +  where False = isinstance('0 s', float)[0m
[31m[1m______________________ test_model_manager_initialization _______________________[0m
[1m[31mtests/test_integration_workflows.py[0m:402: in test_model_manager_initialization
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(active_model, [96mstr[39;49;00m)[90m[39;49;00m
[1m[31mE   assert False[0m
[1m[31mE    +  where False = isinstance(None, str)[0m
[31m[1m________________________ test_meta_conversational_bonus ________________________[0m
[1m[31mtests/test_meta_bonus.py[0m:101: in test_meta_conversational_bonus
    [0m[94massert[39;49;00m episodic_bonus == [94m0.15[39;49;00m, [33mf[39;49;00m[33m"[39;49;00m[33mExpected EPISODIC bonus 0.15, got [39;49;00m[33m{[39;49;00mepisodic_bonus[33m}[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected EPISODIC bonus 0.15, got 0.0[0m
[1m[31mE   assert 0.0 == 0.15[0m
----------------------------- Captured stdout call -----------------------------

=== Test 1: Non-meta query (no bonus) ===

Ranked results (non-meta query):
  1. SUMMARY: score=0.803, meta_bonus=0.00
  2. SEMANTIC: score=0.803, meta_bonus=0.00
  3. EPISODIC: score=0.780, meta_bonus=0.00
  4. META: score=0.705, meta_bonus=0.00

=== Test 2: Meta-conversational query (with bonus) ===

Ranked results (meta-conversational query):
  1. EPISODIC: score=0.953, meta_bonus=0.00
  2. SUMMARY: score=0.903, meta_bonus=0.00
  3. META: score=0.823, meta_bonus=0.00
  4. SEMANTIC: score=0.793, meta_bonus=0.00

=== Verification ===
[31m[1m_ TestPresenceDetection.test_short_emotional_statements[Everything feels heavy-NeedType.PRESENCE] _[0m
[1m[31mtests/test_need_detection.py[0m:34: in test_short_emotional_statements
    [0m[94massert[39;49;00m result.need_type == expected, [33mf[39;49;00m[33m"[39;49;00m[33mExpected [39;49;00m[33m{[39;49;00mexpected[33m}[39;49;00m[33m for [39;49;00m[33m'[39;49;00m[33m{[39;49;00mmessage[33m}[39;49;00m[33m'[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected NeedType.PRESENCE for 'Everything feels heavy'[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PRESENCE: 'presence'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 0.5, 'perspective': 0.0}, 'semantic': {'presence': 0.5372838377952576, 'perspective': 0.23264610767364502}}, explanation='Semantic override: Below thresholds: P=0.54, R=0.23').need_type[0m
[31m[1m_ TestPerspectiveDetection.test_problem_framing_statements[The problem is I don't have enough time-NeedType.PERSPECTIVE] _[0m
[1m[31mtests/test_need_detection.py[0m:57: in test_problem_framing_statements
    [0m[94massert[39;49;00m result.need_type == expected, [33mf[39;49;00m[33m"[39;49;00m[33mExpected [39;49;00m[33m{[39;49;00mexpected[33m}[39;49;00m[33m for [39;49;00m[33m'[39;49;00m[33m{[39;49;00mmessage[33m}[39;49;00m[33m'[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected NeedType.PERSPECTIVE for 'The problem is I don't have enough time'[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.32000000000000006, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 1.5, 'perspective': 1.0}, 'semantic': {'presence': 0.43340203166007996, 'perspective': 0.4376886785030365}}, explanation='Semantic override: Semantic scores too close: P=0.43, R=0.44').need_type[0m
[31m[1m_ TestPerspectiveDetection.test_problem_framing_statements[Maybe I should reconsider my options-NeedType.PERSPECTIVE] _[0m
[1m[31mtests/test_need_detection.py[0m:57: in test_problem_framing_statements
    [0m[94massert[39;49;00m result.need_type == expected, [33mf[39;49;00m[33m"[39;49;00m[33mExpected [39;49;00m[33m{[39;49;00mexpected[33m}[39;49;00m[33m for [39;49;00m[33m'[39;49;00m[33m{[39;49;00mmessage[33m}[39;49;00m[33m'[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected NeedType.PERSPECTIVE for 'Maybe I should reconsider my options'[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 0.5, 'perspective': 1.0}, 'semantic': {'presence': 0.24114924669265747, 'perspective': 0.5806604623794556}}, explanation='Semantic override: Below thresholds: P=0.24, R=0.58').need_type[0m
[31m[1m_ TestPerspectiveDetection.test_problem_framing_statements[What would you do in my situation?-NeedType.PERSPECTIVE] _[0m
[1m[31mtests/test_need_detection.py[0m:57: in test_problem_framing_statements
    [0m[94massert[39;49;00m result.need_type == expected, [33mf[39;49;00m[33m"[39;49;00m[33mExpected [39;49;00m[33m{[39;49;00mexpected[33m}[39;49;00m[33m for [39;49;00m[33m'[39;49;00m[33m{[39;49;00mmessage[33m}[39;49;00m[33m'[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected NeedType.PERSPECTIVE for 'What would you do in my situation?'[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 0.5, 'perspective': 1.0}, 'semantic': {'presence': 0.15095753967761993, 'perspective': 0.4412465989589691}}, explanation='Semantic override: Below thresholds: P=0.15, R=0.44').need_type[0m
[31m[1m_________ TestEdgeCases.test_questions_about_feelings_are_perspective __________[0m
[1m[31mtests/test_need_detection.py[0m:157: in test_questions_about_feelings_are_perspective
    [0m[94massert[39;49;00m result.need_type == NeedType.PERSPECTIVE[90m[39;49;00m
[1m[31mE   AssertionError: assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 0.5, 'perspective': 1.0}, 'semantic': {'presence': 0.3794111907482147, 'perspective': 0.2766943573951721}}, explanation='Semantic override: Below thresholds: P=0.38, R=0.28').need_type[0m
[1m[31mE    +  and   <NeedType.PERSPECTIVE: 'perspective'> = NeedType.PERSPECTIVE[0m
[31m[1m___ TestDebugLogCases.test_debug_log_examples[Morning man!-NeedType.NEUTRAL] ___[0m
[1m[31mtests/test_need_detection.py[0m:174: in test_debug_log_examples
    [0m[94massert[39;49;00m result.need_type == expected_need, \
[1m[31mE   AssertionError: Expected neutral for 'Morning man!...', got presence[0m
[1m[31mE   assert <NeedType.PRESENCE: 'presence'> == <NeedType.NEUTRAL: 'neutral'>[0m
[1m[31mE    +  where <NeedType.PRESENCE: 'presence'> = NeedAnalysis(need_type=<NeedType.PRESENCE: 'presence'>, confidence=0.4, trigger='hybrid_keyword_wins', raw_scores={'keyword': {'presence': 1.5, 'perspective': 0.0}, 'semantic': {'presence': 0.24726511538028717, 'perspective': 0.07211125642061234}}, explanation='Keyword override: Keyword presence signals: 1.5').need_type[0m
[31m[1m_ TestDebugLogCases.test_debug_log_examples[I'm still feeling a little off. Not like yesterday more just frustration. Online dating sucks lol I get so many matches and I think the reason they don't go anywhere is my school/living situation-NeedType.PERSPECTIVE] _[0m
[1m[31mtests/test_need_detection.py[0m:174: in test_debug_log_examples
    [0m[94massert[39;49;00m result.need_type == expected_need, \
[1m[31mE   AssertionError: Expected perspective for 'I'm still feeling a little off. Not like yesterday...', got neutral[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 1.0, 'perspective': 1.5}, 'semantic': {'presence': 0.3588021695613861, 'perspective': 0.1486339122056961}}, explanation='Semantic override: Below thresholds: P=0.36, R=0.15').need_type[0m
[31m[1m____________ TestMessageVariations.test_problem_framing_variations _____________[0m
[1m[31mtests/test_need_detection.py[0m:273: in test_problem_framing_variations
    [0m[94massert[39;49;00m result.need_type == NeedType.PERSPECTIVE, [33mf[39;49;00m[33m"[39;49;00m[33mExpected PERSPECTIVE for [39;49;00m[33m'[39;49;00m[33m{[39;49;00mmsg[33m}[39;49;00m[33m'[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Expected PERSPECTIVE for 'The problem is my schedule'[0m
[1m[31mE   assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTIVE: 'perspective'>[0m
[1m[31mE    +  where <NeedType.NEUTRAL: 'neutral'> = NeedAnalysis(need_type=<NeedType.NEUTRAL: 'neutral'>, confidence=0.24, trigger='hybrid_semantic_wins', raw_scores={'keyword': {'presence': 0.5, 'perspective': 1.0}, 'semantic': {'presence': 0.25217774510383606, 'perspective': 0.3268704116344452}}, explanation='Semantic override: Below thresholds: P=0.25, R=0.33').need_type[0m
[1m[31mE    +  and   <NeedType.PERSPECTIVE: 'perspective'> = NeedType.PERSPECTIVE[0m
[31m[1m__________________________ test_cross_encoder_caching __________________________[0m
[1m[31mtests/test_performance_fix.py[0m:83: in test_cross_encoder_caching
    [0m[94massert[39;49;00m summary[[33m'[39;49;00m[33mcross_encoder_loads[39;49;00m[33m'[39;49;00m] == [94m1[39;49;00m, [33mf[39;49;00m[33m"[39;49;00m[33mShould only load once, but loaded [39;49;00m[33m{[39;49;00msummary[[33m'[39;49;00m[33mcross_encoder_loads[39;49;00m[33m'[39;49;00m][33m}[39;49;00m[33m times[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Should only load once, but loaded 0 times[0m
[1m[31mE   assert 0 == 1[0m
[31m[1m_________________________ test_end_to_end_integration __________________________[0m
[1m[31mtests/test_performance_fix.py[0m:207: in test_end_to_end_integration
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(result, [96mlist[39;49;00m), [33m"[39;49;00m[33mShould return a list of memories[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Should return a list of memories[0m
[1m[31mE   assert False[0m
[1m[31mE    +  where False = isinstance('Test query', list)[0m
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m processing.gate_system:gate_system.py:949 [Batch Gate Error] 'str' object has no attribute 'get'
[33mWARNING [0m prompt_context_gatherer:context_gatherer.py:215 Gating failed, returning original memories: 'str' object does not support item assignment
[31m[1m_________________________________ test_prompt __________________________________[0m
[1m[31mtests/test_prompt_sections.py[0m:23: in test_prompt
    [0mmemory_coordinator = MemoryCoordinator()[90m[39;49;00m
                         ^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: MemoryCoordinator.__init__() missing 2 required positional arguments: 'corpus_manager' and 'chroma_store'[0m
[31m[1m_________________________ test_minmax_normalize_normal _________________________[0m
[1m[31mtests/test_response_generator_comprehensive.py[0m:162: in test_minmax_normalize_normal
    [0m[94massert[39;49;00m [96mmax[39;49;00m(normalized) <= [94m1.0[39;49;00m[90m[39;49;00m
[1m[31mE   assert 10.0 <= 1.0[0m
[1m[31mE    +  where 10.0 = max([0.0, 2.5, 5.0, 7.5, 10.0])[0m
[31m[1m_____________________________ test_thread_tracking _____________________________[0m
[1m[31mtests/test_thread_tracking.py[0m:87: in test_thread_tracking
    [0m[94massert[39;49;00m thread_ctx[[33m'[39;49;00m[33mthread_id[39;49;00m[33m'[39;49;00m] == thread_id_1, [33m"[39;49;00m[33mShould be same thread[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: Should be same thread[0m
[1m[31mE   assert 'thread_20251204_113938' == 'thread_20251204_113937'[0m
[1m[31mE     [0m
[1m[31mE     [0m[91m- thread_20251204_113937[39;49;00m[90m[39;49;00m[0m
[1m[31mE     ?                      ^[90m[39;49;00m[0m
[1m[31mE     [92m+ thread_20251204_113938[39;49;00m[90m[39;49;00m[0m
[1m[31mE     ?                      ^[90m[39;49;00m[0m
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
2025-12-04 11:39:37 [INFO] [test_thread_tracking] ================================================================================
2025-12-04 11:39:37 [INFO] [test_thread_tracking] STARTING THREAD TRACKING TEST
2025-12-04 11:39:37 [INFO] [test_thread_tracking] ================================================================================
2025-12-04 11:39:37 [INFO] [corpus_manager] [CorpusManager] Initializing with file: /tmp/tmpdub0tiqp/test_corpus.json
2025-12-04 11:39:37 [WARNING] [corpus_manager] [CorpusManager] Corpus file not found: /tmp/tmpdub0tiqp/test_corpus.json
2025-12-04 11:39:37 [INFO] [corpus_manager] [CorpusManager] After init, corpus has 0 entries
2025-12-04 11:39:37 [INFO] [memory.storage.multi_collection_chroma_store] [Chroma] Using persistent dir: /tmp/tmpdub0tiqp/test_chroma
2025-12-04 11:39:37 [INFO] [user_profile] [UserProfile] Initialized from data/user_profile.json
2025-12-04 11:39:37 [INFO] [test_thread_tracking] 
================================================================================
2025-12-04 11:39:37 [INFO] [test_thread_tracking] TEST 1: First conversation (should create new thread)
2025-12-04 11:39:37 [INFO] [test_thread_tracking] ================================================================================
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 133.90it/s]
2025-12-04 11:39:37 [INFO] [test_thread_tracking] 
[TEST] Thread context after message 1: {'thread_id': 'thread_20251204_113937', 'thread_depth': 1, 'thread_started': '2025-12-04T11:39:37.067343', 'thread_topic': 'They', 'is_heavy_topic': True}
2025-12-04 11:39:37 [INFO] [test_thread_tracking] 
================================================================================
2025-12-04 11:39:37 [INFO] [test_thread_tracking] TEST 2: Continuing same topic (should continue thread)
2025-12-04 11:39:37 [INFO] [test_thread_tracking] ================================================================================
2025-12-04 11:39:38 [INFO] [httpx] HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-04 11:39:38 [INFO] [httpx] HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
Batches:   0%|          | 0/1 [00:00<?, ?it/s]Batches: 100%|██████████| 1/1 [00:00<00:00, 121.51it/s]
2025-12-04 11:39:38 [INFO] [test_thread_tracking] 
[TEST] Thread context after message 2: {'thread_id': 'thread_20251204_113938', 'thread_depth': 1, 'thread_started': '2025-12-04T11:39:38.169481', 'thread_topic': "Neighbor's Situation", 'is_heavy_topic': False}
------------------------------ Captured log call -------------------------------
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:27 ================================================================================
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:28 STARTING THREAD TRACKING TEST
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:29 ================================================================================
[32mINFO    [0m corpus_manager:corpus_manager.py:42 [CorpusManager] Initializing with file: /tmp/tmpdub0tiqp/test_corpus.json
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:106 [Load Corpus] START
[33mWARNING [0m corpus_manager:corpus_manager.py:69 [CorpusManager] Corpus file not found: /tmp/tmpdub0tiqp/test_corpus.json
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:108 [Load Corpus] END — Duration: 0.00s
[32mINFO    [0m corpus_manager:corpus_manager.py:44 [CorpusManager] After init, corpus has 0 entries
[35mDEBUG   [0m chromadb.config:config.py:359 Starting component System
[35mDEBUG   [0m chromadb.config:config.py:359 Starting component Posthog
[32mINFO    [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:110 [Chroma] Using persistent dir: /tmp/tmpdub0tiqp/test_chroma
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:116 [Chroma] Initialized collection: conversations
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:116 [Chroma] Initialized collection: summaries
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:116 [Chroma] Initialized collection: wiki_knowledge
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:116 [Chroma] Initialized collection: facts
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:116 [Chroma] Initialized collection: reflections
[35mDEBUG   [0m fact_extractor:fact_extractor.py:336 [FactExtractor.__init__] use_rebel=True (pipeline=yes), use_regex=True, spaCy=yes
[35mDEBUG   [0m memory_consolidator:memory_consolidator.py:81 [Consolidator] init threshold=20 lookback=40 min_gap_min=20
[35mDEBUG   [0m user_profile:user_profile.py:84 [UserProfile] Loaded 42 facts
[32mINFO    [0m user_profile:user_profile.py:76 [UserProfile] Initialized from data/user_profile.json
[35mDEBUG   [0m memory_coordinator:memory_coordinator.py:230 [MemoryCoordinator] UserProfile initialized
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:56 
================================================================================
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:57 TEST 1: First conversation (should create new thread)
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:58 ================================================================================
[35mDEBUG   [0m corpus_manager:corpus_manager.py:175 [CorpusManager] Returning 0 recent episodic memories from 0 entries (filtered out summaries + reflections)
[35mDEBUG   [0m thread_manager:thread_manager.py:119 [Thread] Creating new thread (first conversation): thread_20251204_113937
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:106 [Save Corpus] START
[35mDEBUG   [0m corpus_manager:corpus_manager.py:99 Saved 1 entries to corpus
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:108 [Save Corpus] END — Duration: 0.00s
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:235 [ChromaStore] Adding conversation memory with metadata: {'timestamp': '2025-12-04T11:39:37.067589', 'query': 'Did you see the news about ICE raids in Oakland? They arrested 60 people.', 'response': "I saw that. It's very concerning. How are you feeling about it?", 'tags': 'conversation,topic:They', 'topic': 'They', 'truth_score': 0.6, 'importance_score': 0.6, 'access_count': 0, 'last_accessed': '2025-12-04T11:39:37.067593'}
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:260 [ChromaStore] Successfully added conversation memory with ID: b1c5e1c1-614c-47b6-83ef-97bfac2b13b1
[35mDEBUG   [0m memory_storage:memory_storage.py:237 [MemoryStorage] Stored memory b1c5e1c1-614c-47b6-83ef-97bfac2b13b1 (topic=They, truth=0.60)
[35mDEBUG   [0m corpus_manager:corpus_manager.py:175 [CorpusManager] Returning 1 recent episodic memories from 1 entries (filtered out summaries + reflections)
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:68 
[TEST] Thread context after message 1: {'thread_id': 'thread_20251204_113937', 'thread_depth': 1, 'thread_started': '2025-12-04T11:39:37.067343', 'thread_topic': 'They', 'is_heavy_topic': True}
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:73 
================================================================================
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:74 TEST 2: Continuing same topic (should continue thread)
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:75 ================================================================================
[35mDEBUG   [0m corpus_manager:corpus_manager.py:175 [CorpusManager] Returning 1 recent episodic memories from 1 entries (filtered out summaries + reflections)
[35mDEBUG   [0m models.model_manager:logging_utils.py:106 [ModelManager Generate Call] START
[35mDEBUG   [0m main:model_manager.py:468 [generate] Model received: gpt-4o-mini
[35mDEBUG   [0m main:model_manager.py:469 [generate] Known local models: []
[35mDEBUG   [0m main:model_manager.py:470 [generate] Known API models: ['claude-opus', 'claude-opus-4.5', 'sonnet-4.5', 'gpt-4o-mini', 'gpt-4o', 'gpt-4.1', 'gpt-5', 'gpt-5.1', 'glm-4.6', 'deepseek-v3.1', 'deepseek-r1', 'gemini-3-pro', 'gpt-4-turbo']
[35mDEBUG   [0m main:model_manager.py:532 Using OpenAI model alias: openai/gpt-4o-mini
[35mDEBUG   [0m models.model_manager:logging_utils.py:106 [Generate with openAI] START
[35mDEBUG   [0m main:model_manager.py:389 Using prompt caching for model: openai/gpt-4o-mini
[35mDEBUG   [0m openai._base_client:_base_client.py:482 Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-4ffd5f33-d10c-44fc-9b1f-36f9db1ff0f3', 'json_data': {'messages': [{'role': 'system', 'content': [{'type': 'text', 'text': "You extract one short, concrete topic (2–5 words, noun phrase). For emotional/conversational messages, identify the main subject or theme. Examples: 'I am lonely' → 'Loneliness', 'School starts soon' → 'School starting', 'Having trouble with dating' → 'Dating struggles'. No pronouns or vague words (that/this/it/stuff). No punctuation. If impossible, return CONTINUE.", 'cache_control': {'type': 'ephemeral'}}]}, {'role': 'user', 'content': "I'm worried about my neighbor. He's undocumented and has kids in school."}], 'model': 'openai/gpt-4o-mini', 'max_tokens': 16, 'stop': ['\n\nUser:', '\n\nUSER:', '\n\nHuman:'], 'temperature': 0.0, 'top_p': 1.0}}
[35mDEBUG   [0m openai._base_client:_base_client.py:968 Sending HTTP Request: POST https://openrouter.ai/api/v1/chat/completions
[35mDEBUG   [0m httpcore.connection:_trace.py:47 close.started
[35mDEBUG   [0m httpcore.connection:_trace.py:47 close.complete
[35mDEBUG   [0m httpcore.connection:_trace.py:47 connect_tcp.started host='openrouter.ai' port=443 local_address=None timeout=30.0 socket_options=None
[35mDEBUG   [0m httpcore.connection:_trace.py:47 connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f582c598710>
[35mDEBUG   [0m httpcore.connection:_trace.py:47 start_tls.started ssl_context=<ssl.SSLContext object at 0x7f5939927f50> server_hostname='openrouter.ai' timeout=30.0
[35mDEBUG   [0m httpcore.connection:_trace.py:47 start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f582c599d10>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_headers.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_headers.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_body.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_body.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_headers.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 04 Dec 2025 16:39:38 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Content-Encoding', b'gzip'), (b'Access-Control-Allow-Origin', b'*'), (b'Vary', b'Accept-Encoding'), (b'Permissions-Policy', b'payment=(self "https://checkout.stripe.com" "https://connect-js.stripe.com" "https://js.stripe.com" "https://*.js.stripe.com" "https://hooks.stripe.com")'), (b'Referrer-Policy', b'no-referrer, strict-origin-when-cross-origin'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9a8cbdac6a7dead8-ORD')])
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_body.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_body.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 response_closed.started
[35mDEBUG   [0m httpcore.http11:_trace.py:47 response_closed.complete
[35mDEBUG   [0m openai._base_client:_base_client.py:1006 HTTP Response: POST https://openrouter.ai/api/v1/chat/completions "200 OK" Headers({'date': 'Thu, 04 Dec 2025 16:39:38 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'content-encoding': 'gzip', 'access-control-allow-origin': '*', 'vary': 'Accept-Encoding', 'permissions-policy': 'payment=(self "https://checkout.stripe.com" "https://connect-js.stripe.com" "https://js.stripe.com" "https://*.js.stripe.com" "https://hooks.stripe.com")', 'referrer-policy': 'no-referrer, strict-origin-when-cross-origin', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9a8cbdac6a7dead8-ORD'})
[35mDEBUG   [0m openai._base_client:_base_client.py:1014 request_id: None
[35mDEBUG   [0m models.model_manager:logging_utils.py:108 [Generate with openAI] END — Duration: 0.57s
[35mDEBUG   [0m models.model_manager:logging_utils.py:108 [ModelManager Generate Call] END — Duration: 0.57s
[35mDEBUG   [0m query_checker:query_checker.py:620 [Thread] Keyword overlap: last={'raids', 'saw', 'oakland', 'see', 'very', 'concerning', 'ice', 'people', 'feeling', 'news', 'arrested'}, curr={'kids', 'undocumented', 'school', 'neighbor', 'worried'}, overlap=0, union=16, ratio=0.000, score_contrib=0.000
[35mDEBUG   [0m query_checker:query_checker.py:725 [Thread] Continuity check: score=0.250, threshold=0.5, time_diff=1.1s, last_heavy=True, curr_heavy=False, same_topic=False (last=ICE raids, curr=Neighbor's Situation), depth=1
[35mDEBUG   [0m thread_manager:thread_manager.py:151 [Thread] Creating new thread (break detected): thread_20251204_113938 (previous: thread_20251204_113937)
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:106 [Save Corpus] START
[35mDEBUG   [0m corpus_manager:corpus_manager.py:99 Saved 2 entries to corpus
[35mDEBUG   [0m memory.corpus_manager:logging_utils.py:108 [Save Corpus] END — Duration: 0.00s
[35mDEBUG   [0m models.model_manager:logging_utils.py:106 [ModelManager Generate Call] START
[35mDEBUG   [0m main:model_manager.py:468 [generate] Model received: gpt-4o-mini
[35mDEBUG   [0m main:model_manager.py:469 [generate] Known local models: []
[35mDEBUG   [0m main:model_manager.py:470 [generate] Known API models: ['claude-opus', 'claude-opus-4.5', 'sonnet-4.5', 'gpt-4o-mini', 'gpt-4o', 'gpt-4.1', 'gpt-5', 'gpt-5.1', 'glm-4.6', 'deepseek-v3.1', 'deepseek-r1', 'gemini-3-pro', 'gpt-4-turbo']
[35mDEBUG   [0m main:model_manager.py:532 Using OpenAI model alias: openai/gpt-4o-mini
[35mDEBUG   [0m models.model_manager:logging_utils.py:106 [Generate with openAI] START
[35mDEBUG   [0m main:model_manager.py:389 Using prompt caching for model: openai/gpt-4o-mini
[35mDEBUG   [0m openai._base_client:_base_client.py:482 Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-e4a71fe4-6b43-43e7-8007-fab52709a21c', 'json_data': {'messages': [{'role': 'system', 'content': [{'type': 'text', 'text': "You extract one short, concrete topic (2–5 words, noun phrase). For emotional/conversational messages, identify the main subject or theme. Examples: 'I am lonely' → 'Loneliness', 'School starts soon' → 'School starting', 'Having trouble with dating' → 'Dating struggles'. No pronouns or vague words (that/this/it/stuff). No punctuation. If impossible, return CONTINUE.", 'cache_control': {'type': 'ephemeral'}}]}, {'role': 'user', 'content': "I'm worried about my neighbor. He's undocumented and has kids in school."}], 'model': 'openai/gpt-4o-mini', 'max_tokens': 16, 'stop': ['\n\nUser:', '\n\nUSER:', '\n\nHuman:'], 'temperature': 0.0, 'top_p': 1.0}}
[35mDEBUG   [0m openai._base_client:_base_client.py:968 Sending HTTP Request: POST https://openrouter.ai/api/v1/chat/completions
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_headers.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_headers.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_body.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 send_request_body.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_headers.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 04 Dec 2025 16:39:38 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Content-Encoding', b'gzip'), (b'Access-Control-Allow-Origin', b'*'), (b'Vary', b'Accept-Encoding'), (b'Permissions-Policy', b'payment=(self "https://checkout.stripe.com" "https://connect-js.stripe.com" "https://js.stripe.com" "https://*.js.stripe.com" "https://hooks.stripe.com")'), (b'Referrer-Policy', b'no-referrer, strict-origin-when-cross-origin'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9a8cbdafadb9ead8-ORD')])
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_body.started request=<Request [b'POST']>
[35mDEBUG   [0m httpcore.http11:_trace.py:47 receive_response_body.complete
[35mDEBUG   [0m httpcore.http11:_trace.py:47 response_closed.started
[35mDEBUG   [0m httpcore.http11:_trace.py:47 response_closed.complete
[35mDEBUG   [0m openai._base_client:_base_client.py:1006 HTTP Response: POST https://openrouter.ai/api/v1/chat/completions "200 OK" Headers({'date': 'Thu, 04 Dec 2025 16:39:38 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'content-encoding': 'gzip', 'access-control-allow-origin': '*', 'vary': 'Accept-Encoding', 'permissions-policy': 'payment=(self "https://checkout.stripe.com" "https://connect-js.stripe.com" "https://js.stripe.com" "https://*.js.stripe.com" "https://hooks.stripe.com")', 'referrer-policy': 'no-referrer, strict-origin-when-cross-origin', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9a8cbdafadb9ead8-ORD'})
[35mDEBUG   [0m openai._base_client:_base_client.py:1014 request_id: None
[35mDEBUG   [0m models.model_manager:logging_utils.py:108 [Generate with openAI] END — Duration: 0.62s
[35mDEBUG   [0m models.model_manager:logging_utils.py:108 [ModelManager Generate Call] END — Duration: 0.62s
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:235 [ChromaStore] Adding conversation memory with metadata: {'timestamp': '2025-12-04T11:39:38.795359', 'query': "I'm worried about my neighbor. He's undocumented and has kids in school.", 'response': "That's a valid concern. Has he talked to a lawyer about his options?", 'tags': "conversation,topic:Neighbor's Situation", 'topic': "Neighbor's Situation", 'truth_score': 0.5, 'importance_score': 0.6, 'access_count': 0, 'last_accessed': '2025-12-04T11:39:38.795367'}
[35mDEBUG   [0m memory.storage.multi_collection_chroma_store:multi_collection_chroma_store.py:260 [ChromaStore] Successfully added conversation memory with ID: 36f6e6d5-dd58-428b-bfe1-574b853a7793
[35mDEBUG   [0m memory_storage:memory_storage.py:237 [MemoryStorage] Stored memory 36f6e6d5-dd58-428b-bfe1-574b853a7793 (topic=Neighbor's Situation, truth=0.50)
[35mDEBUG   [0m corpus_manager:corpus_manager.py:175 [CorpusManager] Returning 1 recent episodic memories from 2 entries (filtered out summaries + reflections)
[32mINFO    [0m test_thread_tracking:test_thread_tracking.py:86 
[TEST] Thread context after message 2: {'thread_id': 'thread_20251204_113938', 'thread_depth': 1, 'thread_started': '2025-12-04T11:39:38.169481', 'thread_topic': "Neighbor's Situation", 'is_heavy_topic': False}
[31m[1m_______________________ test_semantic_detection_examples _______________________[0m
[1m[31mtests/test_tone_detection.py[0m:389: in test_semantic_detection_examples
    [0m[94massert[39;49;00m result.level [95min[39;49;00m [CrisisLevel.HIGH, CrisisLevel.MEDIUM], ([90m[39;49;00m
[1m[31mE   AssertionError: Failed semantic detection for: 'Everything feels pointless and empty'[0m
[1m[31mE   assert <CrisisLevel.CONCERN: 'light_support'> in [<CrisisLevel.HIGH: 'crisis_support'>, <CrisisLevel.MEDIUM: 'elevated_support'>][0m
[1m[31mE    +  where <CrisisLevel.CONCERN: 'light_support'> = ToneAnalysis(level=<CrisisLevel.CONCERN: 'light_support'>, confidence=1.0, trigger='keyword: empty', raw_scores={}, explanation='Explicit crisis language detected: keyword: empty').level[0m
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
2025-12-04 11:39:41 [INFO] [test_tone] Semantic HIGH test: 'Everything feels pointless and empty' → light_support (confidence: 1.00)
------------------------------ Captured log call -------------------------------
[35mDEBUG   [0m tone_detector:tone_detector.py:361 [ToneDetector] CONCERN keyword detected: 'empty'
[32mINFO    [0m test_tone:test_tone_detection.py:387 Semantic HIGH test: 'Everything feels pointless and empty' → light_support (confidence: 1.00)
[31m[1m_____________________________ test_tone_detection ______________________________[0m
[1m[31mtests/test_tone_execution.py[0m:24: in test_tone_detection
    [0morchestrator = DaemonOrchestrator([90m[39;49;00m
[1m[31mE   TypeError: DaemonOrchestrator.__init__() missing 3 required keyword-only arguments: 'response_generator', 'file_processor', and 'prompt_builder'[0m
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
2025-12-04 11:39:41 [INFO] [test_tone] ============================================================
2025-12-04 11:39:41 [INFO] [test_tone] STARTING TONE DETECTION EXECUTION TEST
2025-12-04 11:39:41 [INFO] [test_tone] ============================================================
------------------------------ Captured log call -------------------------------
[32mINFO    [0m test_tone:test_tone_execution.py:19 ============================================================
[32mINFO    [0m test_tone:test_tone_execution.py:20 STARTING TONE DETECTION EXECUTION TEST
[32mINFO    [0m test_tone:test_tone_execution.py:21 ============================================================
[31m[1m____________________ TestTopicManager.test_general_fallback ____________________[0m
[1m[31mtests/test_topic_detection.py[0m:82: in test_general_fallback
    [0m[94massert[39;49;00m topic [95mis[39;49;00m [95mnot[39;49;00m [94mNone[39;49;00m[90m[39;49;00m
[1m[31mE   assert None is not None[0m
[31m[1m______________________ test_process_files_error_handling _______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:179: in test_process_files_error_handling
    [0mmock_file = create_mock_file([33m"[39;49;00m[33mnonexistent.txt[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33m/nonexistent/path/file.txt[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mtests/unit/test_file_processor.py[0m:69: in create_mock_file
    [0m[94mwith[39;49;00m [96mopen[39;49;00m(path, [33m'[39;49;00m[33mrb[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m f:[90m[39;49;00m
         ^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   FileNotFoundError: [Errno 2] No such file or directory: '/nonexistent/path/file.txt'[0m
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: EpollSelector
[31m[1m_________________________ test_process_single_file_txt _________________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:199: in test_process_single_file_txt
    [0m[94massert[39;49;00m result == [33m"[39;49;00m[33mHello from text file![39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert ('Hello from text file!', 21) == 'Hello from text file!'[0m
[31m[1m_________________________ test_process_single_file_py __________________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:208: in test_process_single_file_py
    [0m[94massert[39;49;00m result.startswith([33m"[39;49;00m[33m```python[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'tuple' object has no attribute 'startswith'[0m
[31m[1m_________________________ test_process_single_file_csv _________________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:219: in test_process_single_file_csv
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mAlice[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'Alice' in ('    name  age\n0  Alice   30\n1    Bob   25', 25)[0m
[31m[1m_____________________ test_process_single_file_unsupported _____________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:231: in test_process_single_file_unsupported
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mUnsupported file type[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'Unsupported file type' in ('[Unsupported file type: test.pdf]', 0)[0m
[31m[1m______________________ test_process_single_file_txt_utf8 _______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:243: in test_process_single_file_txt_utf8
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mHello[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert 'Hello' in ('Hello 世界 🌍', 17)[0m
[31m[1m______________________ test_process_single_file_empty_txt ______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:256: in test_process_single_file_empty_txt
    [0m[94massert[39;49;00m result == [33m"[39;49;00m[33m"[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert ('[Empty file: empty.txt]', 0) == ''[0m
[31m[1m______________________ test_process_single_file_empty_csv ______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:270: in test_process_single_file_empty_csv
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(result, [96mstr[39;49;00m)[90m[39;49;00m
[1m[31mE   AssertionError: assert False[0m
[1m[31mE    +  where False = isinstance(('Empty DataFrame\nColumns: [name, age]\nIndex: []', 9), str)[0m
[31m[1m_______________________ test_csv_with_special_characters _______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:287: in test_csv_with_special_characters
    [0m[94massert[39;49;00m [96misinstance[39;49;00m(result, [96mstr[39;49;00m)[90m[39;49;00m
[1m[31mE   assert False[0m
[1m[31mE    +  where False = isinstance(('            text\n0  Hello, world!\n1  Quote: "test"\n2  Newline\\nhere', 54), str)[0m
[31m[1m_______________________ test_py_file_with_multiline_code _______________________[0m
[1m[31mtests/unit/test_file_processor.py[0m:305: in test_py_file_with_multiline_code
    [0m[94massert[39;49;00m [33m"[39;49;00m[33m```python[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m [95min[39;49;00m result[90m[39;49;00m
[1m[31mE   AssertionError: assert '```python\n' in ('```python\nclass Example:\n    def __init__(self):\n        self.value = 42\n\n    def method(self):\n        return self.value\n```', 111)[0m
[31m[1m_______________________ test_rank_memories_metadata_none _______________________[0m
[1m[31mtests/unit/test_memory_coordinator_methods.py[0m:1504: in test_rank_memories_metadata_none
    [0mranked = coordinator._rank_memories(memories, [33m"[39;49;00m[33mquery[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mmemory/memory_coordinator.py[0m:1128: in _rank_memories
    [0m[94mreturn[39;49;00m [96mself[39;49;00m.scorer.rank_memories(memories, current_query)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mmemory/memory_scorer.py[0m:348: in rank_memories
    [0mtopic_match = [96mself[39;49;00m._calculate_topic_match(m, current_topic)[90m[39;49;00m
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mmemory/memory_scorer.py[0m:179: in _calculate_topic_match
    [0mmemory_topics = memory.get([33m'[39;49;00m[33mmetadata[39;49;00m[33m'[39;49;00m, {}).get([33m'[39;49;00m[33mtopics[39;49;00m[33m'[39;49;00m, [])[90m[39;49;00m
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'NoneType' object has no attribute 'get'[0m
[31m[1m__________________ test_get_tone_instructions_conversational ___________________[0m
[1m[31mtests/unit/test_orchestrator_helpers.py[0m:400: in test_get_tone_instructions_conversational
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mcasual conversation[39;49;00m[33m"[39;49;00m [95min[39;49;00m instructions[90m[39;49;00m
[1m[31mE   assert 'casual conversation' in '\n\n## RESPONSE MODE: CONVERSATIONAL (Natural Friend Voice)\n**Goal: Be a confident, grounded friend - not a service agent, hype-man, or therapist**\n\n**LENGTH: Maximum 3 sentences for most responses**\n\nVoice Calibration - The Sweet Spot:\n❌ TOO HYPE: "Hell yeah you\'re crushing it king! 💪 Die mad haters!"\n❌ TOO SERVICE-Y: "Thanks so much, that\'s awesome to hear! I\'m here anytime!"\n✓ JUST RIGHT: "Ha, glad that\'s better. Hope work goes smooth."\n\nCore Principles:\n1. **Match his energy** - casual when he\'s casual, focused when he\'s technical\n   - ✓ "Nice work on that." / "Solid progress."\n   - ✗ "Thanks so much, that\'s awesome to hear! Always striving to provide value!"\n\n2. **Brief acknowledgments** - you don\'t need to validate every interaction\n   - ✓ "Glad that worked" / "Makes sense" / "Cool"\n   - ✗ "Thank you for your feedback! I\'m excited to keep improving!"\n\n3. **Confident friend** - comfortable in the relationship, not anxious to please\n   - ✓ "That\'s frustrating, but you handled it well."\n   - ✗ "Please let me know if there\'s anything else I can help with!"\n\n4. **Helpful without being formal** - offer perspective naturally\n   - ✓ "Makes sense you\'re annoyed. Moving on sounds right."\n   - ✗ "I appreciate your patience as I strive to deliver relevant information."\n\nFORBIDDEN:\n- Customer service language ("Thanks so much!", "I\'m here anytime!", "Please let me know")\n- Emojis and excessive exclamation points\n- Hype language (crushing it, you got this king, Hell yeah)\n- Corporate speak ("striving to provide", "relevant and valuable info")\n- Excessive gratitude or validation-seeking\n- Multi-paragraph responses for simple updates\n\nThink: You\'re the friend who knows the relationship is solid, so you don\'t need to constantly prove your value or seek approval. Be supportive, honest, and chill.'[0m
[33m=============================== warnings summary ===============================[0m
../.pyenv/versions/3.11.8/lib/python3.11/site-packages/faiss/loader.py:49
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.
    from numpy.core._multiarray_umath import __cpu_features__

<frozen importlib._bootstrap>:241
  <frozen importlib._bootstrap>:241: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute

<frozen importlib._bootstrap>:241
  <frozen importlib._bootstrap>:241: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute

<frozen importlib._bootstrap>:241
  <frozen importlib._bootstrap>:241: DeprecationWarning: builtin type swigvarlink has no __module__ attribute

tests/test_actual_caching.py::test_model_manager_cross_encoder_caching
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_actual_caching.py::test_model_manager_cross_encoder_caching returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_actual_caching.py::test_memory_manager_integration
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_actual_caching.py::test_memory_manager_integration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_health_check.py::test_health_check
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_health_check.py::test_health_check returned <class 'int'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_meta_conversational.py::test_meta_conversational_detection
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_meta_conversational.py::test_meta_conversational_detection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_simple_validation.py::test_cross_encoder_caching
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_simple_validation.py::test_cross_encoder_caching returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_simple_validation.py::test_mock_performance_improvement
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_simple_validation.py::test_mock_performance_improvement returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_stm_live.py::test_stm_in_orchestrator
  /home/lukeh/.pyenv/versions/3.11.8/lib/python3.11/site-packages/websockets/legacy/__init__.py:6: DeprecationWarning: websockets.legacy is deprecated; see https://websockets.readthedocs.io/en/stable/howto/upgrade.html for upgrade instructions
    warnings.warn(  # deprecated in 14.0 - 2024-11-09

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
[36m[1m=========================== short test summary info ============================[0m
[33mSKIPPED[0m [1] tests/test_memory_coordinator_advanced.py:438: _combine_memories has different signature
[33mSKIPPED[0m [1] tests/test_memory_deep_integration.py:195: Method signature different
[33mSKIPPED[0m [1] tests/test_prompt_builder_methods.py:281: tokenizer_manager not available
[33mSKIPPED[0m [1] tests/test_prompt_builder_methods.py:292: tokenizer_manager not available
[33mSKIPPED[0m [1] tests/test_prompt_builder_methods.py:305: tokenizer_manager not available
[33mSKIPPED[0m [1] tests/test_prompt_internal_methods.py:143: tokenizer_manager not available
[33mSKIPPED[0m [1] tests/test_prompt_internal_methods.py:183: tokenizer_manager not available
[31mERROR[0m tests/test_integration_gate_system.py::[1mtest_gated_prompt_builder_initialization[0m - TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values f...
[31mERROR[0m tests/test_integration_gate_system.py::[1mtest_gated_prompt_builder_basic[0m - TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values f...
[31mERROR[0m tests/test_integration_gate_system.py::[1mtest_gated_prompt_builder_with_memories[0m - TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values f...
[31mERROR[0m tests/test_integration_gate_system.py::[1mtest_gated_prompt_integration_flow[0m - TypeError: core.prompt.builder.UnifiedPromptBuilder() got multiple values f...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_full_query_workflow[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_retrieval_with_topics[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_relevance_scoring[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_prompt_building_workflow[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_with_empty_query[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_with_special_characters[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_multiple_sequential_interactions[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_with_long_text[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_prompt_builder_with_empty_memories[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_consolidation_trigger[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_gate_system_integration[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_with_tags_filtering[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_concurrent_memory_operations[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_prompt_builder_token_limiting[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_recent_retrieval[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_with_unicode_content[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_scorer_integration[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mERROR[0m tests/test_integration_workflows.py::[1mtest_memory_retrieval_with_config[0m - TypeError: MultiCollectionChromaStore.__init__() got an unexpected keyword ...
[31mFAILED[0m tests/test_active_day_decay.py::[1mtest_active_day_tracking[0m - AssertionError: Expected 2 active days, got 5
[31mFAILED[0m tests/test_active_day_decay.py::[1mtest_fallback_behavior[0m - TypeError: unsupported operand type(s) for -: 'datetime.datetime' and 'None...
[31mFAILED[0m tests/test_competitive_prototype.py::[1mtest_competitive_vs_baseline[0m - TypeError: UnifiedPromptBuilder._gather_context() got an unexpected keyword...
[31mFAILED[0m tests/test_edge_cases_comprehensive.py::[1mtest_get_facts_empty_query[0m - AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'
[31mFAILED[0m tests/test_edge_cases_comprehensive.py::[1mtest_get_facts_unicode[0m - AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'
[31mFAILED[0m tests/test_full_meta_query.py::[1mtest_full_flow[0m - TypeError: DaemonOrchestrator.__init__() missing 4 required keyword-only ar...
[31mFAILED[0m tests/test_gated_prompt.py::[1mtest_gated_builder[0m - AttributeError: 'str' object has no attribute 'keys'
[31mFAILED[0m tests/test_integration_prompt_advanced.py::[1mtest_get_facts[0m - AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_facts'
[31mFAILED[0m tests/test_integration_prompt_advanced.py::[1mtest_get_recent_facts[0m - AttributeError: 'UnifiedPromptBuilder' object has no attribute 'get_recent_...
[31mFAILED[0m tests/test_integration_prompt_advanced.py::[1mtest_get_token_count[0m - AttributeError: 'NoneType' object has no attribute 'count_tokens'
[31mFAILED[0m tests/test_integration_prompt_builder.py::[1mtest_build_prompt_basic[0m - AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], '...
[31mFAILED[0m tests/test_integration_prompt_builder.py::[1mtest_build_prompt_with_memories[0m - AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], '...
[31mFAILED[0m tests/test_integration_prompt_builder.py::[1mtest_build_prompt_with_search_query[0m - AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], '...
[31mFAILED[0m tests/test_integration_prompt_builder.py::[1mtest_prompt_builder_memory_integration[0m - AssertionError: assert ('current_topic' in {'dreams': [], 'memories': [], '...
[31mFAILED[0m tests/test_integration_workflows.py::[1mtest_time_manager_integration[0m - AssertionError: assert False
[31mFAILED[0m tests/test_integration_workflows.py::[1mtest_model_manager_initialization[0m - assert False
[31mFAILED[0m tests/test_meta_bonus.py::[1mtest_meta_conversational_bonus[0m - AssertionError: Expected EPISODIC bonus 0.15, got 0.0
[31mFAILED[0m tests/test_need_detection.py::[1mTestPresenceDetection::test_short_emotional_statements[Everything feels heavy-NeedType.PRESENCE][0m - AssertionError: Expected NeedType.PRESENCE for 'Everything feels heavy'
[31mFAILED[0m tests/test_need_detection.py::[1mTestPerspectiveDetection::test_problem_framing_statements[The problem is I don't have enough time-NeedType.PERSPECTIVE][0m - AssertionError: Expected NeedType.PERSPECTIVE for 'The problem is I don't h...
[31mFAILED[0m tests/test_need_detection.py::[1mTestPerspectiveDetection::test_problem_framing_statements[Maybe I should reconsider my options-NeedType.PERSPECTIVE][0m - AssertionError: Expected NeedType.PERSPECTIVE for 'Maybe I should reconside...
[31mFAILED[0m tests/test_need_detection.py::[1mTestPerspectiveDetection::test_problem_framing_statements[What would you do in my situation?-NeedType.PERSPECTIVE][0m - AssertionError: Expected NeedType.PERSPECTIVE for 'What would you do in my ...
[31mFAILED[0m tests/test_need_detection.py::[1mTestEdgeCases::test_questions_about_feelings_are_perspective[0m - AssertionError: assert <NeedType.NEUTRAL: 'neutral'> == <NeedType.PERSPECTI...
[31mFAILED[0m tests/test_need_detection.py::[1mTestDebugLogCases::test_debug_log_examples[Morning man!-NeedType.NEUTRAL][0m - AssertionError: Expected neutral for 'Morning man!...', got presence
[31mFAILED[0m tests/test_need_detection.py::[1mTestDebugLogCases::test_debug_log_examples[I'm still feeling a little off. Not like yesterday more just frustration. Online dating sucks lol I get so many matches and I think the reason they don't go anywhere is my school/living situation-NeedType.PERSPECTIVE][0m - AssertionError: Expected perspective for 'I'm still feeling a little off. N...
[31mFAILED[0m tests/test_need_detection.py::[1mTestMessageVariations::test_problem_framing_variations[0m - AssertionError: Expected PERSPECTIVE for 'The problem is my schedule'
[31mFAILED[0m tests/test_performance_fix.py::[1mtest_cross_encoder_caching[0m - AssertionError: Should only load once, but loaded 0 times
[31mFAILED[0m tests/test_performance_fix.py::[1mtest_end_to_end_integration[0m - AssertionError: Should return a list of memories
[31mFAILED[0m tests/test_prompt_sections.py::[1mtest_prompt[0m - TypeError: MemoryCoordinator.__init__() missing 2 required positional argum...
[31mFAILED[0m tests/test_response_generator_comprehensive.py::[1mtest_minmax_normalize_normal[0m - assert 10.0 <= 1.0
[31mFAILED[0m tests/test_thread_tracking.py::[1mtest_thread_tracking[0m - AssertionError: Should be same thread
[31mFAILED[0m tests/test_tone_detection.py::[1mtest_semantic_detection_examples[0m - AssertionError: Failed semantic detection for: 'Everything feels pointless ...
[31mFAILED[0m tests/test_tone_execution.py::[1mtest_tone_detection[0m - TypeError: DaemonOrchestrator.__init__() missing 3 required keyword-only ar...
[31mFAILED[0m tests/test_topic_detection.py::[1mTestTopicManager::test_general_fallback[0m - assert None is not None
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_files_error_handling[0m - FileNotFoundError: [Errno 2] No such file or directory: '/nonexistent/path/...
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_txt[0m - AssertionError: assert ('Hello from text file!', 21) == 'Hello from text fi...
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_py[0m - AttributeError: 'tuple' object has no attribute 'startswith'
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_csv[0m - AssertionError: assert 'Alice' in ('    name  age\n0  Alice   30\n1    Bob ...
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_unsupported[0m - AssertionError: assert 'Unsupported file type' in ('[Unsupported file type:...
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_txt_utf8[0m - AssertionError: assert 'Hello' in ('Hello 世界 🌍', 17)
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_empty_txt[0m - AssertionError: assert ('[Empty file: empty.txt]', 0) == ''
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_process_single_file_empty_csv[0m - AssertionError: assert False
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_csv_with_special_characters[0m - assert False
[31mFAILED[0m tests/unit/test_file_processor.py::[1mtest_py_file_with_multiline_code[0m - AssertionError: assert '```python\n' in ('```python\nclass Example:\n    de...
[31mFAILED[0m tests/unit/test_memory_coordinator_methods.py::[1mtest_rank_memories_metadata_none[0m - AttributeError: 'NoneType' object has no attribute 'get'
[31mFAILED[0m tests/unit/test_orchestrator_helpers.py::[1mtest_get_tone_instructions_conversational[0m - assert 'casual conversation' in '\n\n## RESPONSE MODE: CONVERSATIONAL (Natu...
[31m= [31m[1m45 failed[0m, [32m1480 passed[0m, [33m7 skipped[0m, [33m11 warnings[0m, [31m[1m22 errors[0m[31m in 142.90s (0:02:22)[0m[31m =[0m
